<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="Conda Constructor Thoughts" />
<meta property="og:description" content="Inspired by conversations with Nick Bollweg and Matt Rocklin, I experimented with using conda constructor as the installer for The Littlest JupyterHub. Theoretically, it fit the bill perfectly - I wanted a way to ship arbitrary packages in multiple languages (python &amp; node) in an easy to install self-contained way, didn&rsquo;t want to make debian packages &amp; wanted to use a tool that people in the Jupyter ecosystem were familiar with." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://words.yuvi.in/post/conda-constructor-thoughts/" /><meta property="article:published_time" content="2018-06-28T22:43:56-07:00"/>
<meta property="article:modified_time" content="2018-06-28T22:43:56-07:00"/>
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Conda Constructor Thoughts"/>
<meta name="twitter:description" content="Inspired by conversations with Nick Bollweg and Matt Rocklin, I experimented with using conda constructor as the installer for The Littlest JupyterHub. Theoretically, it fit the bill perfectly - I wanted a way to ship arbitrary packages in multiple languages (python &amp; node) in an easy to install self-contained way, didn&rsquo;t want to make debian packages &amp; wanted to use a tool that people in the Jupyter ecosystem were familiar with."/>
<meta name="generator" content="Hugo 0.47.1" />


    
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "headline": "Conda Constructor Thoughts",
  "url": "http://words.yuvi.in/post/conda-constructor-thoughts/",
  "wordCount": "528",
  "datePublished": "2018-06-28T22:43:56-07:00",
  "dateModified": "2018-06-28T22:43:56-07:00",
  "author": {
    "@type": "Person",
    "name": ""
  },
  "keywords": "code"
}
</script>



    <link rel="canonical" href="http://words.yuvi.in/post/conda-constructor-thoughts/">

    <title>Conda Constructor Thoughts | Yuvi Panda</title>

    <!-- combined, minified CSS -->
    <link href="http://words.yuvi.in/css/style.css" rel="stylesheet" integrity="sha384-O8wjsnz02XiyrPxnhfF6AVOv6YLBaEGRCnVF&#43;DL3gCPBy9cieyHcpixIrVyD2JS5" crossorigin="anonymous">

    

    

    

    

  </head>

  <body>

    <div class="blog-masthead">
    
    </div>

    <header class="blog-header">
      <div class="container">
        <h1 class="blog-title">
            
            <img src='/profile.jpg' width=80 style="border-radius: 50%; margin-bottom: 12px;">
            <a href="http://words.yuvi.in/" rel="home">Yuvi Panda</a></h1>
        <p class="lead blog-description"><a href="https://github.com/jupyterhub/jupyterhub">JupyterHub</a> | <a href="https://mybinder.org">MyBinder</a> | <a href="https://k8s.io">Kubernetes</a> | Open Culture</p>
      </div>
    </header>

    <div class="container">
      <div class="row">
        <div class="col-sm-8 blog-main">

          


<article class="blog-post">
  <header>
    <h2 class="blog-post-title"><a href="http://words.yuvi.in/post/conda-constructor-thoughts/">Conda Constructor Thoughts</a></h2>
    <p class="blog-post-meta"><time datetime="2018-06-28T22:43:56-07:00">Thu Jun 28, 2018</time> by  in 
<i class="fa fa-folder" aria-hidden="true"></i>&nbsp;<a href="/categories/code" rel="category tag">code</a>


</p>
  </header>
  

<p>Inspired by conversations with <a href="https://github.com/bollwyvl">Nick Bollweg</a> and
<a href="http://matthewrocklin.com/">Matt Rocklin</a>, I experimented with using
<a href="https://github.com/conda/constructor">conda constructor</a> as the installer for
<a href="http://words.yuvi.in/post/the-littlest-jupyterhub/">The Littlest JupyterHub</a>.
Theoretically, it fit the bill perfectly - I wanted a way to ship arbitrary
packages in multiple languages (python &amp; node) in an easy to install self-contained way,
didn&rsquo;t want to make debian packages &amp; wanted to use a tool that people in the Jupyter
ecosystem were familiar with. Constructor seemed to provide just that.</p>

<p>I sortof got it working, but in the end ran into enough structural problems that
I decided it isn&rsquo;t the right tool for this job. This blog post is a note to my
future self on <em>why</em>.</p>

<p>This isn&rsquo;t a &lsquo;takedown&rsquo; of conda or conda constructor - just a particular
use case where it didn&rsquo;t work out and a demonstration of how little I know
about conda. It probably works great if you are doing more scientific computing
and less &lsquo;ship a software system&rsquo;!</p>

<h2 id="does-not-work-with-conda-forge">Does not work with <code>conda-forge</code></h2>

<p>I &lt;3 <a href="https://conda-forge.org/">conda-forge</a> and the community around
it. I know there&rsquo;s a nice <a href="https://anaconda.org/conda-forge/jupyterhub">jupyterhub</a>
package there, which takes care of installing JupyterHub, node, and required
node modules.</p>

<p>However, this doesn&rsquo;t actually work. conda constructor does not support
<a href="https://www.anaconda.com/blog/developer-blog/condas-new-noarch-packages/">noarch packages</a>,
and JupyterHub relies on several <code>noarch</code> packages. From my understanding,
more <code>conda-forge</code> packages are moving towards being <code>noarch</code> (for good reason!).</p>

<p>Looking at <a href="https://github.com/conda/constructor/issues/86">this issue</a>,
it doesn&rsquo;t look like this is a high priority item for them to fix anytime soon.
I understand that - they don&rsquo;t owe the world free work! It just makes conda
constructor a no-go for my use case&hellip;</p>

<h2 id="no-support-for-pip">No support for pip</h2>

<p>You can pip install packages in a conda environment, and they mostly just work.
There are a <em>lot</em> of python packages on PyPI that are installable via pip that
I&rsquo;d like to use. constructor doesn&rsquo;t support bundling these, which is entirely
fair! <a href="https://github.com/conda/constructor/pull/96">This PR</a> attempted something
here, but was rejected.</p>

<p>So if I want to keep using packages that don&rsquo;t exist in <code>conda-forge</code> yet but
do exist in pip, I would have to make sure these packages and all their dependencies
exist as conda packages too. This would be fine if constructor was giving
me enough value to justify it, but right now it is not. I&rsquo;ve also tried going
down a similar road (<em>cough</em> debian <em>cough</em>) and did not want to do that again :)</p>

<h2 id="awkward-post-install-bash">Awkward <code>post-install.bash</code></h2>

<p>I wanted to set up systemd units post install. Right off the bat this should
have made me realize conda constructor was not the right tool for the job :D
The only injected environment variable is <code>$PREFIX</code>, which is not super helpful
if you wanna do stuff like &lsquo;copy this systemd unit file somewhere&rsquo;. I ended up
writing a small python module that does all these things, and calling it from
post-install. However, even then I couldn&rsquo;t pass any environment variables to it,
making testing / CI hard.</p>

<h2 id="current-solution">Current solution</h2>

<p>Currently, we have a <a href="https://github.com/yuvipanda/the-littlest-jupyterhub/blob/9cc05a9d627515a01b68e244a970079481be7d9e/installer/install.bash">bootstrap script</a>
that downloads miniconda, &amp; bootstraps from there to a full JupyterHub install.
Things like systemd units &amp; sudo rules are managed by a <a href="https://github.com/yuvipanda/the-littlest-jupyterhub/tree/9cc05a9d627515a01b68e244a970079481be7d9e/tljh">python module</a>
that is called from the bootstrap script.</p>


  

  
  <hr>
  <footer>

  
    <section>
    <h4>Share</h4>
    <nav class="nav sharing-icons">
      <a class="nav-item" href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwords.yuvi.in%2fpost%2fconda-constructor-thoughts%2f" title="Share on Facebook"><span class="fa fa-facebook fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://plus.google.com/share?url=http%3a%2f%2fwords.yuvi.in%2fpost%2fconda-constructor-thoughts%2f" title="Share on Google+"><span class="fa fa-google-plus fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwords.yuvi.in%2fpost%2fconda-constructor-thoughts%2f" title="Share on LinkedIn"><span class="fa fa-linkedin fa-2x" aria-hidden="true"></span></a>
      <a class="nav-item" href="https://twitter.com/home?status=http%3a%2f%2fwords.yuvi.in%2fpost%2fconda-constructor-thoughts%2f" title="Tweet this"><span class="fa fa-twitter fa-2x"></span></a>
    </nav>
  </section>

  

  
  </footer>
  

</article> 



        </div> <!-- /.blog-main -->

        <aside class="col-sm-3 ml-auto blog-sidebar">
  
  <section class="sidebar-module sidebar-module-inset">
    <h4>about</h4>
    <p>I build infrastructure that helps reduce accidental complexities when using code to solve problems.</p>
  </section>
  
  <section class="sidebar-module sidebar-module-inset">
    <h4>projects</h4>
    <p><p>Primarily working on <a href="https://z2jh.jupyter.org">Zero to JupyterHub</a> and <a href="https://mybinder.org">MyBinder</a></p>

<p>See more on my <a href="https://github.com/yuvipanda">GitHub Profile</a></p>
</p>
  </section>
  
  <section class="sidebar-module sidebar-module-inset">
    <h4>work</h4>
    <p><p>I design, build &amp; operate large scale teaching infrastructure for the <a href="https://data.berkeley.edu/">Data Science Division at UC Berkeley</a>.</p>

<p>I also help run <a href="https://mybinder.org">MyBinder</a> thanks to a generous grant from the Gordon &amp; Betty Moore Foundation.</p>
</p>
  </section>
  
  <section class="sidebar-module sidebar-module-inset">
    <h4>contact</h4>
    <p><a href="mailto:yuvipanda@gmail.com">Email</a> is the best way to contact me privately.
<a href="https://twitter.com/yuvipanda">Twitter</a> is the best way to contact me publicly.</p>
  </section>
  

  
        <section class="sidebar-module">
    <h4>Recent Posts</h4>
    <ol class="list-unstyled">


<li><a href="/post/devlog-2018-12-26/">Devlog 2018 12 26</a></li>

<li><a href="/post/devlog-2018-12-24/">Devlog 2018 12 24</a></li>

<li><a href="/post/devlog-2018-12-23/">DevLog 2018 December 23</a></li>

<li><a href="/post/oss-in-the-cloud/">Freedoms for Open Source Software users in the Cloud</a></li>

<li><a href="/post/aug-2018-plan/">Aug 2018 Work Plan</a></li>

    </ol>
  </section>

  

  
</aside>


      </div> <!-- /.row -->
    </div> <!-- /.container -->

    <footer class="blog-footer">
      <p>
      
      Blog template created by <a href="https://twitter.com/mdo">@mdo</a>, ported to Hugo by <a href='https://twitter.com/mralanorth'>@mralanorth</a>.
      
      </p>
      <p>
      <a href="#">Back to top</a>
      </p>
    </footer>

  </body>

</html>
