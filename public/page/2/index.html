<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Yuvi</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Yuvi" /><meta name="description" content="Recovering overachieving child, now trying to achieve the correct amount" /><meta name="keywords" content="yuvi, yuvipanda" />






<meta name="generator" content="Hugo 0.121.2 with theme even" />


<link rel="canonical" href="https://words.yuvi.in/" />
  <link href="https://words.yuvi.in/index.xml" rel="alternate" type="application/rss+xml" title="Yuvi" />
  <link href="https://words.yuvi.in/index.xml" rel="feed" type="application/rss+xml" title="Yuvi" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.5cd638ef09e6be2c903018f2f2bfacabe243faf0dc08773cdc9c2da41e81e4cc.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">



<link rel="stylesheet" href="/lib/fontawesome-free-5.13.1-web/css/all.min.css">

<meta property="og:title" content="Yuvi" />
<meta property="og:description" content="Recovering overachieving child, now trying to achieve the correct amount" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://words.yuvi.in/" />

<meta itemprop="name" content="Yuvi">
<meta itemprop="description" content="Recovering overachieving child, now trying to achieve the correct amount"><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Yuvi"/>
<meta name="twitter:description" content="Recovering overachieving child, now trying to achieve the correct amount"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Yuvi</a>
  <div class='logo-site-description'>Recovering overachieving child, now trying to achieve the correct amount
  </div>
</div>

<div class="logo-social">
      <a href="mailto:yuvipanda@gmail.com" class="fas fa-envelope" title="envelope"></a>
      <a href="https://hachyderm.io/@yuvipanda" class="fab fa-twitter" title="twitter"></a>
      <a href="https://github.com/yuvipanda" class="fab fa-github" title="github"></a>
  <a href="https://words.yuvi.in/index.xml" type="application/rss+xml" class="fas fa-rss" title="rss"></a>
</div>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <section id="posts" class="posts">
    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/jupyterlab-settings-z2jh/">Disabling JupyterLab extensions on your z2jh JupyterHub installations</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2021-12-15 </span>
      
        <span class="more-meta"> 318 words </span>
        <span class="more-meta"> 2 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>Sometimes you want to temporarily disable a JupyterLab extension on a JupyterHub
by default, without having to rebuild your docker image. This can be very
easily done with z2jh&rsquo;s <a href="https://zero-to-jupyterhub.readthedocs.io/en/latest/resources/reference.html#singleuser-extrafiles">singleuser.extraFiles</a>,
and JupyterLab&rsquo;s <a href="https://jupyterlab.readthedocs.io/en/stable/user/directories.html#labconfig-directories">page_config.json</a></p>
<p>JupyterLab&rsquo;s <code>page_config.json</code> lets you set page configuration by dropping JSON files
under a <code>labconfig</code> directory inside any of the directories listed when you run <code>jupyter --paths</code>.
We just use <code>singleuser.extraFiles</code> to provide this file!</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">singleuser</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraFiles</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">lab-config</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span><span style="color:#111">:</span> <span style="color:#ae81ff">/etc/jupyter/labconfig/page_config.json</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">data</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">disabledExtensions</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">jupyterlab-link-share</span><span style="color:#111">:</span> <span style="color:#00a8c8">true</span>
</span></span></code></pre></div><p>This will disable the <a href="https://github.com/jupyterlab-contrib/jupyterlab-link-share">link-share</a>
labextension, both in JupyterLab and RetroLab. You can find the name of the
extension, as well as its current status, with <code>jupyter labextension list</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>jovyan@jupyter-yuvipanda:~$ jupyter labextension list
</span></span><span style="display:flex;"><span>JupyterLab v3.2.4
</span></span><span style="display:flex;"><span>/opt/conda/share/jupyter/labextensions
</span></span><span style="display:flex;"><span>        jupyterlab-plotly v5.4.0 enabled OK
</span></span><span style="display:flex;"><span>        jupyter-matplotlib v0.9.0 enabled OK
</span></span><span style="display:flex;"><span>        jupyterlab-link-share v0.2.4 disabled OK (python, jupyterlab-link-share)
</span></span><span style="display:flex;"><span>        @jupyter-widgets/jupyterlab-manager v3.0.1 enabled OK (python, jupyterlab_widgets)
</span></span><span style="display:flex;"><span>        @jupyter-server/resource-usage v0.6.0 enabled OK (python, jupyter-resource-usage)
</span></span><span style="display:flex;"><span>        @retrolab/lab-extension v0.3.13 enabled OK
</span></span></code></pre></div><p>This is extremely helpful if the same image is being shared across hubs, and
you want some of the hubs to have some of the extensions.</p>
<p><code>singleuser.extraFiles</code> can be used like this for <em>any</em> jupyter config, or generally
any config file anywhere. For example, here&rsquo;s some config that culls idle running
kernels, and shuts down notebooks after 60m of inactivity:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">singleuser</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">extraFiles</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">culling-config</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">mountPath</span><span style="color:#111">:</span> <span style="color:#ae81ff">/etc/jupyter/jupyter_notebook_config.json</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">data</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">NotebookApp</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># shutdown the server after no 30 mins of no activity</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">shutdown_no_activity_timeout</span><span style="color:#111">:</span> <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># if a user leaves a notebook with a running kernel,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># the effective idle timeout will typically be CULL_TIMEOUT + CULL_KERNEL_TIMEOUT</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># as culling the kernel will register activity,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># resetting the no_activity timer for the server as a whole</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">MappingKernelManager</span><span style="color:#111">:</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># shutdown kernels after 30 mins of no activity</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cull_idle_timeout</span><span style="color:#111">:</span> <span style="color:#ae81ff">1800</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># check for idle kernels this often</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cull_interval</span><span style="color:#111">:</span> <span style="color:#ae81ff">60</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># a kernel with open connections but no activity still counts as idle</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># this is what allows us to shutdown servers</span>
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># when people leave a notebook open and wander off</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">cull_connected</span><span style="color:#111">:</span> <span style="color:#00a8c8">true</span>
</span></span></code></pre></div>
  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/on-crypto/">Personal stance on &#39;crypto&#39; and &#39;web3&#39;</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2021-11-18 </span>
      
        <span class="more-meta"> 636 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>This post is inspired by a slack conversation with <a href="https://twitter.com/rabernat/">Ryan Abernathey</a>
and <a href="https://twitter.com/drsarahlgibson/">Sarah Gibson</a>.</p>
<p>It is very important to me that we don&rsquo;t exist in a world where the Internet is just centralized
and controlled by a few huge, hypercapitalist players. I&rsquo;ve written about ways the open source
community can help here (<a href="https://words.yuvi.in/post/oss-in-the-cloud/">by not tying ourselves to a single provider</a>),
and helped draft the <a href="https://2i2c.org/right-to-replicate/">right to replicate</a> policy to
put it into effect at 2i2c. This topic is important to me - I don&rsquo;t want a future where
step 1 of learning to code is something extremely vendor specific.</p>
<p>Theoretically, this is very well within the scope of the &lsquo;web3&rsquo; movement (quite different from
the <a href="https://en.wikipedia.org/wiki/Semantic_Web">web 3.0</a> movement which has mostly died out).
I would love for that to be the case, but unfortunately I&rsquo;ve found almost nothing about the
&lsquo;crypto&rsquo; or &lsquo;web3&rsquo; communities attractive. I&rsquo;m going to try write down why in this post.</p>
<p>Most of this isn&rsquo;t unique thought - others have written about these with much more citations,
and deeper analysis than I have. I encourate you to seek those out and read them. This is also
not an exhaustive list, but a bare minimum.</p>
<h2 id="environmental-impact-of-proof-of-work">Environmental impact of proof of work</h2>
<p>Difficult for me to get past the environmental impact of most proof of work systems. Any
renewable energy they use is energy that could be used to take more fossil fuels off
the grid. I don&rsquo;t want proof of work systems to switch to renewable energy - I want them
to stop existing.</p>
<h2 id="the-rich-get-richer">The rich get richer</h2>
<p>In the economic models of almost all &lsquo;crypto&rsquo;, growing inequality is a feature,
not a bug.  This is outright formalized in Proof of Stake systems, and is
de-facto true in most Proof of Work systems. I don&rsquo;t really want to live in a
world that is even more unequal than the one I live in now. Fixes to this would
be fundamental to any possible positive outcome from the &lsquo;crypto&rsquo; community.</p>
<h2 id="distributed-ledger-is-not-a-solution-to-many-problems">&ldquo;Distributed Ledger&rdquo; is not a solution to many problems</h2>
<p>The buzzwordiness of &lsquo;blockchain&rsquo;, &lsquo;crypto&rsquo; and &lsquo;web3&rsquo; mean they&rsquo;re now being
forcefit into problems they are very poor solutions for.
Every time I see the word &lsquo;blockchain&rsquo;, I mentally replace it with &lsquo;distributed ledger&rsquo;,
and see if it can still be a good fit for the given problem. Most often, it does not.
Problems often have to be reframed in terms of &rsquo;transactions&rsquo; to have a blockchain solve them,
and I think this reframing is often fundamentally problematic - life isn&rsquo;t
transactional. When all you have is a distributed ledger, everything looks like
a problem of incentives.</p>
<p>So any time something purports to solve a problem that is <em>not</em> use as a
currency using a blockchain, consider carefully the problem it is solving, and
seeing if the solutions it is proposing actually solve the problem in a way that
is generally usable given latency and throughput consideration.</p>
<h2 id="lets-evaluate-the-tech-on-a-case-by-case-basis">Let&rsquo;s evaluate the tech on a case-by-case basis</h2>
<p>The <a href="https://fediverse.party/">fediverse</a> is quite cool. I think of <a href="https://ipfs.io/">IPFS</a>
as the spiritual successor to bittorrent in many ways (yes, I know they consider themselves
to be <code>web3</code>). There&rsquo;s a lot of really cool conceptual work happening in
removing ourselves from being beholden to a couple of major corporations that doesn&rsquo;t
necessarily require buying into a speculative, environmentally disastrous property bubble.
I want to evaluate each tech that might be solving a problem I find important, but if
it has brought in strongly to the &lsquo;crypto&rsquo; or &lsquo;web3&rsquo; hype, it just has a much bigger
bar to clear to prove that it just isn&rsquo;t a speculative ponzi scheme.</p>
<p>I can&rsquo;t wait for the huge amounts of money, wasteful proof of work and the hype
train to die out, so we can pick up the useful tech that comes out of this.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/announcing-notebooksharing-space/">The fastest way to share your notebooks - announcing NotebookSharing.space</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2021-11-16 </span>
      
        <span class="more-meta"> 1042 words </span>
        <span class="more-meta"> 5 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p><img src="/images/nbss-logo.svg" alt="NotebookSharing.space logo"></p>
<p><strong>Sharing notebooks is harder than it should be</strong>.</p>
<p>You are working on a notebook (in Jupyter, RStudio, Visual Studio Code, whatever), and want
to share it quickly with someone. Maybe you want some feedback, or you&rsquo;re demonstrating
a technique, or there is a cool result you want to quickly show someone. A million reasons
to want to quickly share a notebook, but unfortunately there isn&rsquo;t a quick enough and
easy enough solution right now. That&rsquo;s why I built <a href="https://notebooksharing.space">notebooksharing.space</a>,
focused specifically on solving the problem of - &ldquo;I have a notebook, I want to quickly
share it with someone else&rdquo;.</p>
<p>Ryan Abernathey captures the current frustration, and lays out a possible glorious
future for what a &lsquo;share a notebook I am working on&rsquo; workflow might look like. NotebookSharing.space
is a start in tackling part of this. I highly recommend reading this thread.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Someone on Twitter asked me to share a notebook. I&#39;m frustrated that in late 2021 we still don&#39;t have a simple, open-science-approved way to do this. A üßµ about some of the options (cc <a href="https://twitter.com/choldgraf?ref_src=twsrc%5Etfw">@choldgraf</a>, <a href="https://twitter.com/yuvipanda?ref_src=twsrc%5Etfw">@yuvipanda</a>) ... /1 <a href="https://t.co/mnd3K68JgV">https://t.co/mnd3K68JgV</a></p>&mdash; Ryan Abernathey (@rabernat) <a href="https://twitter.com/rabernat/status/1446495829397839875?ref_src=twsrc%5Etfw">October 8, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="just-upload-no-signup-necessary">Just upload, no signup necessary</h2>
<p>As the goal is to have the fastest way to upload your notebook and share it with
someone, there is <em>no signup or user accounts necessary</em>. Just upload your notebook,
get the link, and share it however you want. Notebook links are permalinks - once uploaded,
a notebook can not be changed. You can only upload a new notebook and get a new link.</p>
<p>The upload is a bit slow in the video demos here because I&rsquo;m sitting on a hammock in a remote beach,
but should be much faster for you.</p>
<p>You can upload your notebook easily via the web interface at <a href="https://notebooksharing.space">notebooksharing.space</a>:</p>
<p><video controls src="/screencasts/nbss-launch/web-upload.mp4" width="100%" autoplay></video></p>
<p>Once uploaded, the web interface will just redirect you to the beautifully rendered notebook,
and you can copy the link to the page and share it!</p>
<p>Or you can directly use the <code>nbss-upload</code> commandline tool:</p>
<p><video controls src="/screencasts/nbss-launch/commandline.mp4" width="100%" autoplay></video></p>
<p>On Macs, you can pipe the output of <code>nbss-upload</code> to <code>pbcopy</code> to automatically put the
link in your clipboard. Here is the <a href="https://notebooksharing.space/view/db27d9df0768fc62611dbdfa5f5a08525f1b1d637706cc1ad1d6973cb7d4a90e#displayOptions=">example notebook</a> that I
uploaded, so you can check out how it looks.</p>
<p>A <a href="https://github.com/notebook-sharing-space/jupyterlab-nbsss">jupyterlab extension</a> to
streamline this process is currently being worked on, and I&rsquo;d appreciate any help. I&rsquo;d
also love to have extensions for classic Jupyter Notebook, RStudio (via an <a href="https://rstudio.github.io/rstudioaddins/">addin</a>),
Visual Studio Code, and other platforms.</p>
<h2 id="provide-feedback-with-collaborative-annotations">Provide feedback with collaborative annotations</h2>
<p>When uploading, you can opt-in to have collaborative annotations enabled
on your notebook via the open source, web standards based <a href="https://hypothes.is/">hypothes.is</a>
service. You can thus directly annotate the notebook, instead of having to email
back and forth about &rsquo;that cell where you are importing matplotlib&rsquo; or &rsquo;that graph
with the blue border&rsquo;. <strong>This is one of the coolest features of notebooksharing.space</strong>.</p>
<p><video controls src="/screencasts/nbss-launch/annotations.mp4" autoplay width="100%"></video></p>
<p>You can annotate the notebook demoed in the video <a href="https://notebooksharing.space/view/2ccc2fefe2a07b081a499993b739d6e444fcee5120ba0e076745303d5bb6d4d8">here</a>. Note that you
need a free <a href="https://web.hypothes.is/">hypothes.is</a> account to annotate, but not to read.</p>
<p>Annotations are opt-in to limit unintended abuse. Enabling an unrestricted comments
section on every notebook you upload is probably a terrible idea.</p>
<h2 id="private-by-default">Private by default</h2>
<p>By default, search engines do not index your notebooks - you have to opt-in to making
them discoverable while you are uploading the notebook. This way, only those you
share the link to the notebook with can view it. But be careful about putting notebooks
with secret keys or sensitive data up here, as anyone with a link can still view it -
just won&rsquo;t be able to <em>discover</em> it with search engines.</p>
<h2 id="rmarkdown-and-other-formats-are-supported">RMarkdown and other formats are supported</h2>
<p>It has always been important to me that the R community is treated as a first class
citizen in all the tools I build. Naturally, NotebookSharing.space supports
class support for R Notebooks as well as R Markdown files experimentally. R Notebooks produced by
RStudio are HTML files, and will be rendered appropriately, including outputs (see
<a href="https://notebooksharing.space/view/c0c16296ad33ccbccc717b45c889194d09415744e8df10a27d0382715a07672c#displayOptions=">example</a>). RMarkdown
(<code>.rmd</code>) files only contain code and markdown, and will be rendered appropriately
(see <a href="https://notebooksharing.space/view/468d71e31b3d685154c070b34f3ca88ab1eebf2ff96677ec2dbbc01b1f830897#displayOptions=">example</a>)
). If you enable annotations, they will work here too! I would <em>love</em> for more
feedback from the R community on how to make this work better for you. In
particular, an <a href="https://rstudio.github.io/rstudioaddins/">RStudio Addin</a> that
lets you share with a single shortcut key from RStudio would be an amazing
project to build.</p>
<p>If you work primarily in the R community, I&rsquo;d love to work with you to improve
support here. I know there are bugs and rough edges, and would love for them to get better.</p>
<p>Internally, the wonderful <a href="https://github.com/mwouts/jupytext">jupytext</a> project is
used to read various notebook formats, so anything it supports is supported on
NotebookSharing.space. This means <code>.py</code> files and <code>.md</code> files produced by Jupytext
or Visual Studio code will also be rendered correctly, albeit without outputs as those
are not stored in these files.</p>
<h2 id="next-steps">Next steps?</h2>
<p>I want extensions that let you publish straight from wherever you are working -
<a href="https://github.com/notebook-sharing-space/jupyterlab-nbsss">JupyterLab</a>,
classic Jupyter Notebook, RStudio and VS Code. That should speed up how fast you
can share considerably. Any help here is <em>most</em> welcome!</p>
<p>I also want users to interactively run the notebooks they find here easily.
This involves some integration with mybinder.org most likely, where you (or the
notebook author) can specify which <em>environment</em> to launch the notebook into.
Wouldn&rsquo;t it be wonderful to have a &lsquo;Make interactive&rsquo; button or similar that
can immediately put the notebook back into an interactive mode?</p>
<p>Tweets from here on in Ryan&rsquo;s twitter thread sell this vision well.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">But neither of these options has a link to execution.<br><br>However, I made the notebook on a cloud-based <a href="https://twitter.com/ProjectJupyter?ref_src=twsrc%5Etfw">@ProjectJupyter</a> Hub run by <a href="https://twitter.com/2i2c_org?ref_src=twsrc%5Etfw">@2i2c_org</a>, so I know the exact environment it was run in. The environment was built automatically by <a href="https://t.co/vf7xPeQwqv">https://t.co/vf7xPeQwqv</a> 4/</p>&mdash; Ryan Abernathey (@rabernat) <a href="https://twitter.com/rabernat/status/1446495833290051586?ref_src=twsrc%5Etfw">October 8, 2021</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<h2 id="feedback">Feedback</h2>
<p>I <em>love</em> feedback! That&rsquo;s why I spend my time building these. <a href="https://github.com/notebook-sharing-space/nbss/issues">Open an issue</a>
or <a href="https://twitter.com/yuvipanda">tweet at me</a>. As with all my projects, this is community built
and run - so please come join me :)</p>
<h2 id="inspiration">Inspiration</h2>
<p>Growing up on IRC, <a href="https://en.wikipedia.org/wiki/Pastebin">pastebin</a> services
are part of life. In 2018, <a href="https://github.blog/2018-02-18-deprecation-notice-removing-anonymous-gist-creation/">GitHub stopped supporting anonymous
gists</a></p>
<ul>
<li>so sharing a notebook with someone became a lot more work.
NotebookSharing.space hopefully plugs that gap. The excellent
<a href="https://rpubs.com/">rpubs.com</a> is also an inspiration!</li>
</ul>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/nbgitpuller-link-generator-extension/">Announcing the nbgitpuller Link Generator browser extensions</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2021-11-16 </span>
      
        <span class="more-meta"> 504 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>(Leave comments or discuss this post on the <a href="https://discourse.jupyter.org/t/announcing-the-nbgitpuller-link-generator-browser-extensions/11701">jupyter discourse</a>)</p>
<p><a href="https://jupyterhub.github.io/nbgitpuller">nbgitpuller</a> is my most favorite way to distribute
content (notebooks, data files, etc) to students on a JupyterHub. The student mental model is
&lsquo;I click a link, and can start working on my notebook&rsquo;, which is as close to ideal as we have today.
That is possible since <em>all</em> the information required for this workflow is embedded in the link
itself - so it can be distributed easily via your pre-existing communication channel (like
email, <a href="http://data8.org/sp21/">course website</a>, etc), rather than requiring your students to use
yet another tool.</p>
<p>However, <em>creating</em> these links often been a bit clunky and error prone. The current
<a href="https://jupyterhub.github.io/nbgitpuller/link">link generator</a> is pretty awesome, but requires
a lot of manual copy pasting, and is prone to errors. Particularly problematic was the GitHub
switching of the default branch from <code>master</code> to <code>main</code>, which really caused problems for many
instructors.</p>
<p>To make life easier, I&rsquo;ve now written a browser extension that lets you create these links
straight from the GitHub interface!</p>
<p>On the GitHub page for files, folders and repositories, it adds an
&rsquo;nbgitpuller&rsquo; button.</p>
<p><img src="/images/nbgitpuller-link-screenshots/screenshot-button.png" alt="nbgitpuller button"></p>
<p>On clicking this, you can enter a JupyterHub URL and the application
you want to use to open this file, folder or repository. Then you
can just copy the nbgitpuller URL, and share it with your students!</p>
<p><img src="/images/nbgitpuller-link-screenshots/screenshot-popover.png" alt="nbgitpuller popover"></p>
<p>The JupyterHub URL and application you choose are remembered, so
you do not need to enter it over and over again.</p>
<h2 id="how-to-install">How to install?</h2>
<h3 id="on-mozilla-firefox">On Mozilla Firefox</h3>
<p>I ‚ù§Ô∏è Mozilla Firefox, and you can install the extension there easily from
the official <a href="https://addons.mozilla.org/en-US/firefox/addon/nbgitpuller-link-generator/">addons store</a>.
You&rsquo;ll also get automatic updates with new features and bug fixes this way.</p>
<h3 id="on-google-chrome">On Google Chrome</h3>
<p>On Google Chrome / Chromium, I have submitted the extension to the Chrome Web Store -
but apparently there is a manual review process, and it can take <em>weeks</em>. In the meantime,
you can install it with the following steps</p>
<ol>
<li>Download the <code>.zip</code> version of the latest <a href="https://github.com/yuvipanda/nbgitpuller-link-generator/releases">release</a>
of the extension. You want the file named <code>nbgitpuller_link_generator-&lt;version&gt;.zip</code>.</li>
<li>Extract the <code>.zip</code> file you downloaded.</li>
<li>In your Google Chrome / Chromium, go to <a href="chrome://extensions/">chrome://extensions</a>.</li>
<li>Enable the <em>Developer Mode</em> toggle in the top right. This should make a few options visible
in a new toolbar.</li>
<li>Select <em>Load Unpacked</em>, and select the directory into which the downloaded <code>.zip</code> file
was extracted to. This directory should contain at least a <code>manifest.json</code> file that
was part of the <code>.zip</code> file.</li>
</ol>
<h3 id="other-browsers">Other browsers</h3>
<p>The extension is written as a <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions">WebExtension</a>,
so should work easily in other browsers - Safari, Edge, etc. However, since I do not
use them myself, I don&rsquo;t have instructions on how to add them there. However, if you do
use those browsers, I&rsquo;d <a href="https://github.com/yuvipanda/nbgitpuller-link-generator-webextension">love contributions</a>
on how to install the extension there!</p>
<h2 id="contribute">Contribute!</h2>
<p>The extension was a overnight hack, and it made me <em>very</em> happy to get it shipped. There is
a <em>lot</em> of room for improvement - I would love for you to provide feedback and
contribute in any way possible <a href="https://github.com/yuvipanda/nbgitpuller-link-generator-webextension">on GitHub</a></p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/learning-r/">Learning R</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2021-05-14 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          </div>
        <span class="more-meta"> 267 words </span>
        <span class="more-meta"> 2 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>I&rsquo;m paying money to learn datascience with R via <a href="https://www.coursera.org/learn/data-scientists-tools/home/welcome">this John Hopkins course</a> on Coursera. Hopefully I can spend about 4h a week on it.</p>
<h2 id="why">Why?</h2>
<p>I try to have a &lsquo;T&rsquo; shaped set of competencies - some competence in a lot of areas, and deeper knowledge in some. Having some competence in many areas lets you notice where a particular skill can be very helpful in solving a problem, and either apply it yourself or bring in someone who can. Interesting problems are found in intersections, and learning this will give me access to more intersections :)</p>
<p>It is also an extremely useful skillset - I am sure I can apply it to more problems than I can apply (for example) cloud computing knowledge.</p>
<p>I&rsquo;ve been building tools for data scientists for a while now, but since I don&rsquo;t actually know much about data science itself my effectiveness is limited.</p>
<h2 id="why-this-course">Why this course?</h2>
<p>I went to coursera.org, typed &lsquo;data science&rsquo; and this was the first that showed up :D</p>
<h2 id="why-r">Why R?</h2>
<p>I already know Python as a programming language, which sometimes makes it difficult for me to learn data science via it. Many courses targetted at people with my level of skill in data science / stats also teach some python alongside, and I often found that distracting.</p>
<p>With my JupyterHub contributor hat on, I think it&rsquo;s extremely important that R is a first class citizen in all the teaching &amp; research tools I build. Getting some experience using it will help in this goal.</p>
<h2 id="why-this-blog-post">Why this blog post?</h2>
<p>Just as a form of external accountability.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/hub-interfaces/">The many ways to access your JupyterHub environment</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-11-09 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          </div>
        <span class="more-meta"> 792 words </span>
        <span class="more-meta"> 4 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>JupyterHub was designed to provide multi-user access to Classic Jupyter notebook and JupyterLab, running on machines far away with access to data &amp; compute your local machines don&rsquo;t have. However, there are a <em>lot</em> of users this leaves out - R users on RStudio, folks who prefer <code>ssh</code> based interfaces, people on local IDEs like vscode or pycharm, etc. We trust that these users know better than &lsquo;us&rsquo; developers &amp; admins what user interface works best for them, and make sure that our JupyterHub setups work for them.</p>
<p>I propose that we try provide the following in all JupyterHub setups, but particularly on cloud-based deployments focused on research.</p>
<ol>
<li>
<p>Arbitrary web applications on the browser, not just classic notebook &amp; JupyterLab. This could be RStudio / Shiny for R folks, <a href="https://github.com/fonsp/Pluto.jl">Pluto.jl</a> for Julia folks, <a href="https://theia-ide.org/">Theia IDE</a> or <a href="https://github.com/cdr/code-server">vscode</a> for arbitrary languages, etc. These need to be first class citizens with amazing support. <a href="https://github.com/jupyterhub/jupyter-server-proxy/">jupyter-server-proxy</a> does a lot of this already - but still needs to be &lsquo;set up&rsquo; in your deployment. DO IT!</p>
</li>
<li>
<p><code>ssh</code> support, so you can <code>ssh yuvipanda@myhub.org</code>, and have it work as you would expect. It should have the same environment &amp; home directories as your browser based sessions. Along with something like <a href="https://words.yuvi.in/post/kbatch/">kbatch</a>, this could let folks who like their current HPC style workflows keep it. SFTP for file transfer, SSH Tunneling, scripting via command execution, etc should also come along with this, allowing re-use with a vast array of existing tools &amp; workflows.</p>
</li>
<li>
<p>Connecting from local IDEs, for notebook execution. The Jupyter protocol is designed to work with a variety of frontends, and many IDEs support connecting directly to a Jupyter kernel - <a href="https://code.visualstudio.com/docs/python/jupyter-support">Visual Studio Code</a>, <a href="https://www.jetbrains.com/help/pycharm/jupyter-notebook-support.html">PyCharm</a>, <a href="https://medium.com/@halmubarak/connecting-spyder-ide-to-a-remote-ipython-kernel-25a322f2b2be">spyder</a>, <a href="https://github.com/nnicandro/emacs-jupyter">emacs</a>, etc. There is already decent-ish support for this, but would be nice to explicitly document, bugfix and promote this to users.</p>
</li>
<li>
<p>Connecting from local IDEs for a full remote development environment. Connecting to a remote Jupyter kernel often doesn&rsquo;t give you all that you want from your IDE - no access to remote filesystem, limited access from other IDE features (version control, global find, etc). Many IDEs offer a &lsquo;remote development&rsquo; experience that gives you all this, and usually requiring just a few SSH features to work. VSCode&rsquo;s <a href="https://code.visualstudio.com/docs/remote/remote-overview">remote development</a> feature is very well done, popular and <strong>not open source</strong>, but we should support it. <a href="https://blog.jetbrains.com/pycharm/2018/04/running-flask-with-an-ssh-remote-python-interpreter/">PyCharm</a> supports this, and Emacs&rsquo; <a href="https://www.emacswiki.org/emacs/TrampMode">TRAMP</a> is highly rated as well.</p>
</li>
</ol>
<p>You might not need some of these in your deployment - for example, you might have no R users, rendering RStudio not very useful. However, I think the world is getting more and more polyglot, and we need to move with it. Consider deploying these, even if your users don&rsquo;t explicitly ask for it - I suspect many will use it once it is there. &lt;3</p>
<h2 id="work-to-be-done">Work to be done</h2>
<p>There&rsquo;s a lot of work to be done here to make this all a great experience.</p>
<ol>
<li>Documentation and publicity for <a href="https://github.com/jupyterhub/jupyter-server-proxy/">jupyter-server-proxy</a>. For example, this <a href="https://github.com/jupyterhub/jupyter-rsession-proxy/">README</a> is all the docs that exist on how to set up RStudio to work in your JupyterHub. This is low hanging fruit with huge impact. Same for running remote <a href="https://github.com/yuvipanda/jupyter-desktop-server/">desktop applications</a>, <a href="https://github.com/IllumiDesk/jupyter-pluto-proxy">Pluto.jl</a>, and many many others.</li>
<li>Work on <a href="https://github.com/yuvipanda/jupyterhub-ssh">jupyterhub-ssh</a>. Aims to provide full SSH support - terminal emulation, command execution, tunneling and SFTP. This would go a long way in supporting (2) and (4) above. It sortof-kinda works now, but effort poured into it will be well spent. I long for a day when setting this up would be as simple as setting up z2jh or TLJH, and it actually isn&rsquo;t that far away if effort is put into it.</li>
<li>More outreach to non-Jupyter communities about levaraging JupyterHub for their workflows. The name &lsquo;Jupyter&rsquo; in &lsquo;JupyterHub&rsquo; is no longer fully accurate, given all the other things that can be run with it. We should reach out to other communities and &lsquo;bring them into the fold&rsquo;, so to speak - so their workflows, desires and bugs can drive development.</li>
<li>A unified setup guide for &lsquo;research hubs&rsquo;, that guides first-time admins through setting these up - including great documentation. A <code>z2jh for research hubs on the cloud</code> would be extremely well received I believe.</li>
</ol>
<h2 id="will-you-help">Will you help?</h2>
<p>I&rsquo;ve been talking to <a href="https://predictablynoisy.com/">Chris Holdgraf</a> a lot on how to go about getting folks into doing stuff like this. I see two primary options:</p>
<ol>
<li>Get funding from various entities (foundations, universities, corporations, etc) for folks to do this. Hopefully <a href="https://2i2c.org/">2i2c</a> can be a vehicle for this.</li>
<li>Pour a lot more effort into getting more new developers into JupyterHub development than we are now. This would mean things like participating in Google Summer of Code, Outreachy, development sprints in various conferences, etc.</li>
</ol>
<p>Would love to hear thoughts from you, dear reader :) Email <code>yuvipanda@gmail.com</code>.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/kbatch/">kbatch: sbatch, but for kubernetes</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-11-01 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          </div>
        <span class="more-meta"> 639 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>Submitting &rsquo;non-interactive&rsquo; jobs that can run independent of a user&rsquo;s current
session on a JupyterHub is a pressing problem. There are many many solutions to
this, but I think there&rsquo;s a lot of value in having an <em>extremely</em> simple
solution that solves exactly one extremely well defined problem.</p>
<p>We will only consider JupyterHubs running on top of Kubernetes, since that has all the actual capabilities we need to solve this problem. We only need to have a UX wrapper around it.</p>
<h2 id="problem-to-solve">Problem to solve</h2>
<blockquote>
<p>If my JupyterHub session is terminated, all the code running there dies -
including any dask sessions I might have - even though they are handled
externally by dask-gateway.</p>
</blockquote>
<p>This is trivially accomplished in batch scheduling systems like <code>slurm</code>, but
JupyterHub doesn&rsquo;t have a <em>simple</em> paradigm for it. It would be very, very
useful for it to have one.</p>
<h2 id="stealing-from-slurm">Stealing from slurm</h2>
<p>Slurm has the <a href="https://slurm.schedmd.com/sbatch.html">sbatch</a> command for submitting jobs, and the <a href="https://slurm.schedmd.com/squeue.html">squeue</a> command for viewing job information. They have a large number of options that can do extremely complicated things - but I <em>think</em> we can copy a tiny subset of their functionality to solve our specific problem. We will not be copying all its behaviors, nor try to be compatible with it - just be <em>inspired</em>.</p>
<h3 id="kbatch"><code>kbatch</code></h3>
<p><code>kbatch</code> would be an equivalent to <code>sbatch</code> - just submitting jobs. You can specify the resources your job would need (CPUs, memory, GPUs, etc), give it a script to execute, and it&rsquo;ll just submit it and return. Nothing more! At least to begin with, it wouldn&rsquo;t have a lot of the complex features <code>sbatch</code> has - no array tasks, no multi-step jobs, etc. It would just be a script (or a notebook) that can run <em>independent of the current notebook session</em>. If you want parallelism, you should use dask from this script.</p>
<p>Other names for this could be something like <code>ksubmit</code> or <code>kbackground</code> or similar - the core thing it does is to <code>submit jobs</code>.</p>
<p>Options this command would have:</p>
<ol>
<li>Script (or notebook to run)</li>
<li>Resources it needs (CPU, memory, GPU, etc)</li>
<li>Where to send stdout / stderr (by default, mimic <code>sbatch</code> behavior and put it on your homedir)</li>
<li>Job name / comment for you to keep track of it</li>
</ol>
<p>Users shouldn&rsquo;t have to specify environment or home directories - these should be automatically detected to match current JupyterHub notebook environment. We could probably allow <code>KBATCH</code> commands in the script, similar to <code>SBATCH</code> commands - but more conversation with people who actually use this is needed :)</p>
<h3 id="kqueue"><code>kqueue</code></h3>
<p><code>kqueue</code> would let you check in on the status of your jobs - wether they were running, stopped, failed, etc.</p>
<p>That&rsquo;s it. I think just with these two, we can provide users the ability to run background jobs, from the commandline, similar to how they do so with slurm. We can eventually write GUIs for this fairly easily, since the functionality provided by them is quite simple.</p>
<h3 id="extra-features">Extra features?</h3>
<p>We can easily add more features - tailing logs, getting a shell into your running job to poke around, array jobs, etc. But it would be very nice if we can keep it a simple tool that can be marked <em>complete</em> once it solves the very specific problem it set out to solve.</p>
<h2 id="implementation">Implementation</h2>
<p><a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">Kubernetes Jobs</a> provide literally everything we need. We will write a simple python application that uses the kubernetes API to do everything. All meta-information will be stored as labels in the Kubernetes Job object, and the python application will be responsible for providing the appropriate UX to our users.</p>
<h2 id="caveats">Caveats</h2>
<p>This is <em>extremely</em> simple, and isn&rsquo;t meant for more complex DAG use cases. For those, look at something like Airflow or Prefect or any of the million other things that exist. This is a small UX improvement over <code>kubectl</code>, basically.</p>
<p>Now, let&rsquo;s go do it!</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/production-tljh/">Setting up a &#34;Production Ready&#34; TLJH</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-09-16 </span>
      
        <span class="more-meta"> 868 words </span>
        <span class="more-meta"> 5 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p><a href="http://tljh.jupyter.org/">The Littlest JupyterHub</a> is an extremely
capable hub distribution that I&rsquo;d recommend for situations where you
expect, on average, under 100 active users.</p>
<h2 id="why-not-kubernetes">Why not Kubernetes?</h2>
<p>The primary reason to use Zero to JupyterHub on k8s over TLJH in cases with smaller
number of users would be to reduce costs - Kubernetes can spin down nodes when
not in use. However, you&rsquo;ll always have at least one node running - for the hub
/ proxy pods. The extra complexity that comes with it is not worth it - particulary
around needing to build your own docker images - is not worth it. TLJH works perfectly
well for these cases!</p>
<h2 id="what-is-production">What is &lsquo;production&rsquo;?</h2>
<p>A JupyterHub that you can run itself securely without lots of intervention
from the person who created it is what I&rsquo;ll call a <em>production-ready</em> JupyterHub.
It&rsquo;s a pretty arbitrary standard. In this blog post, I&rsquo;ll lay out what <strong>I</strong> want
in the TLJH hubs I run before I let users on them.</p>
<h2 id="authentication">Authentication</h2>
<p>Uses a <em>real</em> <a href="https://tljh.jupyter.org/en/latest/howto/index.html#authentication">Authenticator</a>,
not the default <code>FirstUseAuthenticator</code>. The default authenticator is pretty insecure,
and should really not be used. If you don&rsquo;t know what to use, I&rsquo;ll suggest the Google or
GitHub authenticators.</p>
<h2 id="https">HTTPS</h2>
<p>Enable <a href="https://tljh.jupyter.org/en/latest/howto/admin/https.html">HTTPS</a>. An absolute
requirement, TLJH makes it quite easy. You <em>do</em> need to get a domain for this to work,
which can be a source of friction. Totally worth it, and many authenticators require
this too.</p>
<h2 id="resource-limits">Resource Limits</h2>
<p>In many systems, a single user can often write code that accidentally crashes the whole system.
By default, TLJH protects against this by enforcing <a href="https://tljh.jupyter.org/en/latest/topic/tljh-config.html#user-server-limits">memory limits</a>.
I think the default is a 1G limit, but you should tune it to fit your own users. TLJH
has more documentation on <a href="">how to estimate your VM size</a>
based on your expected usage patterns.</p>
<h2 id="sizing-your-vm-correctly">Sizing your VM correctly</h2>
<p>If you choose a VM that&rsquo;s too big, you&rsquo;ll end up spending a lot of cash for unused
resources. If it&rsquo;s too small, your users will not have the resources they need to
do their work. TLJH provides <a href="https://tljh.jupyter.org/en/latest/howto/admin/resource-estimation.html">some helpful docs</a>
estimating your VM size, and you can always <a href="https://tljh.jupyter.org/en/latest/howto/admin/resize.html">resize</a>
your VM afterwards if you get it wrong.</p>
<h2 id="disk-backups">Disk backups</h2>
<p>TLJH contains everything on the VM&rsquo;s disk - your user environment, users&rsquo; home directories,
current hub configuration, etc. It is very important you back this up, to recover in case
of disasters. Automated disk snapshots from your cloud provider are an easy way to do this.
Most major cloud providers offer a way to do this - <a href="https://cloud.google.com/compute/docs/disks/create-snapshots">Google Cloud</a>,
<a href="https://www.digitalocean.com/docs/images/snapshots/">Digital Ocean</a>, <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EBSSnapshots.html">AWS</a>,
etc. Some let you automate it as well - Google &amp; AWS certainly do, I&rsquo;m not sure about other
clodu providers. This isn&rsquo;t the <em>best</em> way to do backup - there&rsquo;s approximately
1 billion ways to do so. However, this is an absolute minimum, and it might just be enough.</p>
<p>If you want to be more fancy, I&rsquo;d suggest using a separate disk / volume for your user home
directories, possibly on <a href="https://wiki.ubuntu.com/ZFS">ZFS</a>, and snapshot much more
aggressively. Talk to your nearest google search bar for your options.</p>
<h2 id="pin-your-public-ip">Pin your public IP</h2>
<p>Some cloud providers often your VM&rsquo;s public IP address if you start / stop them. This
can be pretty bad - you&rsquo;ll have to change your domain&rsquo;s DNS entry, and re-aquire HTTPS.
A hassle! You can tell your cloud provider to hang on to your IP even if your VM
goes down / changes. And you should! DigitalOcean doesn&rsquo;t require this,
but <a href="https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address">google does</a>.
I think AWS does too, but I&rsquo;m not sure how you can reserve the public IP for it -
since it&rsquo;s usually a domain name itself.</p>
<h2 id="base-environment-setup--snapshot">Base environment setup + snapshot</h2>
<p>TLJH has a shared conda environment that is used by <em>all</em> users. Everyone can read
from it, but only users who are <code>admin</code> can write to it (via <code>sudo</code>). This is one of
TLJH&rsquo;s core design tradeoffs - admins can install packages the way they are used to,
without requiring a separate image-build step. But it also means the admin can mess
it up - conda environments can be sometimes fickle! So it&rsquo;s not a bad idea to
spend some time in the beginning setting everything up - python packages,
JupyterLab extensions, etc. Then make a disk snapshot, so you can revert to it
if things go bad (this is where having a separate disk for your user home
directories comes in handy).</p>
<h2 id="ssh-admin-access">SSH admin access</h2>
<p>The TLJH documentation strives hard to make sure SSH isn&rsquo;t <em>required</em> for setup and
most common usage. However, if your TLJH breaks in certain ways, you can no longer
access the machine - since all access is via TLJH! For this, I recommend making sure
someone who is admin has SSH access to the VM. Most cloud providers offer a way to
set the root ssh key on creation. If not, you can follow the many guides on the internet
to making it happen.</p>
<p>You can also just put your ssh keys in <code>$HOME/.ssh/authorized_keys</code>, and ssh in as
<code>jupyter-&lt;username&gt;@&lt;hub-ip&gt;</code>. This works for any / all users!</p>
<h2 id="others">Others?</h2>
<p>I&rsquo;m sure this isn&rsquo;t the end - probably need something about firewalls, monitoring and automated
system package upgrades. But hey, great start!</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/dask-local-kubernetes/">Access dask-kubernetes clusters running on a cloud from your local machine</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-06-27 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          <a href="/categories/dask/"> dask </a>
          </div>
        <span class="more-meta"> 934 words </span>
        <span class="more-meta"> 5 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>You can run your Jupyter Notebook locally, and connect easily to a remote <code>dask-kubernetes</code> cluster
on a cloud-based Kubernetes Cluster with the help of <a href="https://kubefwd.com/">kubefwd</a>. This notebook
will show you an example of how to do so. While this example is a Jupyter Notebook, the code will work
any local python medium - REPL, IDE (vscode), or just plain ol&rsquo; <code>.py</code> files</p>
<p>Latest executable version of this notebook can be found in <a href="https://github.com/yuvipanda/cloud-local-dask-kubernetes">this repository</a></p>
<h2 id="credit">Credit</h2>
<p>This work was sponsored by <a href="https://www.quansight.com/">Quansight</a> ‚ù§Ô∏è</p>
<h2 id="create--setup-a-kubernetes-cluster">Create &amp; setup a Kubernetes cluster</h2>
<p>You need to have a working kubernetes cluster that is configured correctly. If you can get
<code>kubectl get ns</code> to work properly, it means your cluster is working fine &amp; connected for
this to go.</p>
<h2 id="install--run-kubefwd">Install &amp; run kubefwd</h2>
<p><code>kubefwd</code> lets you access services in your cloud Kubernetes cluster as if they were
localy, with a clever combination of ol&rsquo; school <code>/etc/hosts</code> hacks &amp; fancy kubernetes
port-forwarding. It requires root on Mac OS &amp; Linux, and should theoretically work on
Windows too (haven&rsquo;t tested).</p>
<p>Once you have installed it, run it in a separate terminal.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo kubefwd svc -n default -n kube-system
</span></span></code></pre></div><p>If you&rsquo;ve created your own namespace for your cluster, use that instead of <code>default</code>.
The <code>kube-system</code> is required until <a href="https://github.com/txn2/kubefwd/issues/132">this issue</a>
is fixed.</p>
<p>If the <code>kubefwd</code> command runs successfully, we&rsquo;re good to go!</p>
<h2 id="install-libraries-well-need">Install libraries we&rsquo;ll need</h2>
<p>In addition to <code>dask-kubernetes</code>, we&rsquo;ll also need <code>numpy</code> to test our cluster with dask arrays.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">%</span><span style="color:#111">pip</span> <span style="color:#111">install</span> <span style="color:#111">numpy</span> <span style="color:#111">dask</span> <span style="color:#111">distributed</span> <span style="color:#111">dask</span><span style="color:#f92672">-</span><span style="color:#111">kubernetes</span>
</span></span></code></pre></div><h2 id="setup-dask-kubernetes-configuration">Setup dask-kubernetes configuration</h2>
<p>Normally, the pod template would come from an external configuration file.
We keep this in the notebook to make it more self contained.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">POD_SPEC</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d88200">&#39;kind&#39;</span><span style="color:#111">:</span> <span style="color:#d88200">&#39;Pod&#39;</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d88200">&#39;metadata&#39;</span><span style="color:#111">:</span> <span style="color:#111">{},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#d88200">&#39;spec&#39;</span><span style="color:#111">:</span> <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#39;restartPolicy&#39;</span><span style="color:#111">:</span> <span style="color:#d88200">&#39;Never&#39;</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>        <span style="color:#d88200">&#39;containers&#39;</span><span style="color:#111">:</span> <span style="color:#111">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#39;image&#39;</span><span style="color:#111">:</span> <span style="color:#d88200">&#39;daskdev/dask:latest&#39;</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#39;args&#39;</span><span style="color:#111">:</span> <span style="color:#111">[</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#d88200">&#39;dask-worker&#39;</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#d88200">&#39;--death-timeout&#39;</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;60&#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#111">],</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d88200">&#39;name&#39;</span><span style="color:#111">:</span> <span style="color:#d88200">&#39;dask&#39;</span><span style="color:#111">,</span>
</span></span><span style="display:flex;"><span>            <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#111">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#111">}</span>
</span></span><span style="display:flex;"><span><span style="color:#111">}</span>
</span></span></code></pre></div><h2 id="create-a-remote-cluster--connect-to-it">Create a remote cluster &amp; connect to it</h2>
<p>We create a <code>KubeCluster</code> object, with <code>deploymode='remote'</code>. This creates
the scheduler as a pod on the cluster, so worker &lt;-&gt; scheduler communication
is easy &amp; efficient. <code>kubefwd</code> helps us communicate to this remote scheduler,
so we can pretend we are actually on the remote cluster.</p>
<p>If you are using <code>kubectl</code> to watch the objects created in your namespace,
you&rsquo;ll see a <code>service</code> and a <code>pod</code> created for this. <code>kubefwd</code> should
also list a log line about forwarding the service port locally.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> <span style="color:#111">dask_kubernetes</span> <span style="color:#f92672">import</span> <span style="color:#111">KubeCluster</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#111">cluster</span> <span style="color:#f92672">=</span> <span style="color:#111">KubeCluster</span><span style="color:#f92672">.</span><span style="color:#111">from_dict</span><span style="color:#111">(</span><span style="color:#111">POD_SPEC</span><span style="color:#111">,</span> <span style="color:#111">deploy_mode</span><span style="color:#f92672">=</span><span style="color:#d88200">&#39;remote&#39;</span><span style="color:#111">)</span>
</span></span></code></pre></div><h2 id="create-some-workers">Create some workers</h2>
<p>We have a scheduler in the cloud, now time to create some workers in the
cloud! We create 2, and can watch the worker pods come up with glee in
<code>kubectl</code></p>
<p>All scaling methods (adaptive scaling, using the widget, etc) should work
here.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">cluster</span><span style="color:#f92672">.</span><span style="color:#111">scale</span><span style="color:#111">(</span><span style="color:#ae81ff">2</span><span style="color:#111">)</span>
</span></span></code></pre></div><h2 id="run-some-computation">Run some computation!</h2>
<p>We test our cluster by doing some trivial calculations with dask arrays.
You can use any dask code as you normally would here, and it would
run on the cloud Kubernetes cluster. This is especially helpful if you
have large amounts of data in the cloud, since the workers would be
really close to where the data is.</p>
<p>You might get warnings about version mismatches. This is ok for the demo,
in production you&rsquo;d probably build your own docker image that will
have fixed versions.</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> <span style="color:#111">dask.distributed</span> <span style="color:#f92672">import</span> <span style="color:#111">Client</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> <span style="color:#111">dask.array</span> <span style="color:#00a8c8">as</span> <span style="color:#111">da</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Connect Dask to the cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#111">client</span> <span style="color:#f92672">=</span> <span style="color:#111">Client</span><span style="color:#111">(</span><span style="color:#111">cluster</span><span style="color:#111">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Create a large array and calculate the mean</span>
</span></span><span style="display:flex;"><span><span style="color:#111">array</span> <span style="color:#f92672">=</span> <span style="color:#111">da</span><span style="color:#f92672">.</span><span style="color:#111">ones</span><span style="color:#111">((</span><span style="color:#ae81ff">1000</span><span style="color:#111">,</span> <span style="color:#ae81ff">1000</span><span style="color:#111">,</span> <span style="color:#ae81ff">1000</span><span style="color:#111">))</span>
</span></span><span style="display:flex;"><span><span style="color:#111">print</span><span style="color:#111">(</span><span style="color:#111">array</span><span style="color:#f92672">.</span><span style="color:#111">mean</span><span style="color:#111">()</span><span style="color:#f92672">.</span><span style="color:#111">compute</span><span style="color:#111">())</span>  <span style="color:#75715e"># Should print 1.0</span>
</span></span></code></pre></div><h2 id="cleanup-dask-cluster">Cleanup dask cluster</h2>
<p>When you&rsquo;re done with your cluster, remember to clean it up to release
the resources!</p>
<p>This doesn&rsquo;t affect your kubernetes cluster itself - you&rsquo;ll need to
clean that up manually</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#111">cluster</span><span style="color:#f92672">.</span><span style="color:#111">close</span><span style="color:#111">()</span>
</span></span></code></pre></div><h2 id="next-steps">Next steps?</h2>
<p>Lots more we can do from here.</p>
<h3 id="ephemeral-kubernetes-clusters">Ephemeral Kubernetes Clusters</h3>
<p>We can wrap kubernetes cluster creation in some nice python functions, letting users create kubernetes clusters just-in-time for running a dask-kubernetes cluster, and tearing it down when they&rsquo;re done. Users can thus &lsquo;bring their own compute&rsquo; - since the clusters will be in their cloud accounts - without having the complication of understanding how the cloud works. This is where this would be different from the wonderful <a href="https://gateway.dask.org">dask-gateway</a> project I think.</p>
<h3 id="remove-kubefwd">Remove kubefwd</h3>
<p><code>kubefwd</code> isn&rsquo;t strictly necessary, and should ideally be replaced by a <code>kubectl port-forward</code> call that doesn&rsquo;t require root. This should be possible with some changes to the <code>dask-kubernetes</code> code, so the client can connect to the scheduler via a different address (say, <code>localhost:8974</code>, since that&rsquo;s what <code>kubectl port-forward</code> gives us) vs the workers (which need something like <code>dask-cluster-scheduler-c12.namespace:8786</code>, since that is in-cluster address).</p>
<p>Longer term, it would be great if we can get rid of spawning other processes altogether, if/when the python kubernetes client gains the <a href="https://github.com/kubernetes-client/python/issues/166">ability to port-forward</a>.</p>
<h3 id="integration-with-tljh">Integration with TLJH</h3>
<p>I love <a href="https://tljh.jupyter.org">The Littlest JupyterHub (TLJH)</a>. A common use case is that a group of
users need a JupyterHub, mostly doing work that&rsquo;s well seved by TLJH. However, sometimes they
need to scale up to a big dask cluster to do some work, but not for long. In these cases, I believe
a combination of TLJH + Ephemeral Kubernetes Clusters is far simpler &amp; easier to manage than running
a full Kubernetes based JupyterHub. In addition, we can share the conda environment from TLJH with
the dask workers, <strong>removing the need for users to think about docker images or environment
mismatches completely</strong>. This is a massive win, and merits further exploration.</p>
<h3 id="heading">???</h3>
<p>I am not actually an end user of dask, so I&rsquo;m sure actual dask users will have much more ideas.
Or they won&rsquo;t, and this will just end up being a clever hack that gives me some joy :D Who
knows!</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/google-domain/">Check if an organization is using GSuite</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-06-18 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          </div>
        <span class="more-meta"> 150 words </span>
        <span class="more-meta"> 1 min read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>I needed to find out if an organization was using <a href="https://gsuite.google.com/">GSuite</a> for their emails, so I can allow their users to login to a <a href="https://github.com/berkeley-dsep-infra/datahub/tree/ab2bf49be680480cf9de07968561257e7810850f/deployments/buds-2020">JupyterHub</a> I was setting up. I use Google Auth in other places, so I wanted to find out if this organization was using GSuite.</p>
<p>I could&rsquo;ve just <em>asked</em> them, but where&rsquo;s the fun in that? Instead, you can use <code>dig</code> to find out!</p>
<p>For example, if I were to test <code>berkeley.edu</code>, I can run:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ dig -t mx berkeley.edu
</span></span></code></pre></div><p>This gives me a bunch of output, the important bits of which are:</p>
<div class="highlight"><pre tabindex="0" style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>;; ANSWER SECTION:
</span></span><span style="display:flex;"><span>berkeley.edu.		242	IN	MX	5 alt1.aspmx.l.google.com.
</span></span><span style="display:flex;"><span>berkeley.edu.		242	IN	MX	10 alt3.aspmx.l.google.com.
</span></span><span style="display:flex;"><span>berkeley.edu.		242	IN	MX	10 alt4.aspmx.l.google.com.
</span></span><span style="display:flex;"><span>berkeley.edu.		242	IN	MX	1 aspmx.l.google.com.
</span></span><span style="display:flex;"><span>berkeley.edu.		242	IN	MX	5 alt2.aspmx.l.google.com.
</span></span></code></pre></div><p>This means that mail to <code>anyone@berkeley.edu</code> is routed via Google, so I know this organization is using GSuite for their users!</p>

  </div>
</article>

    </section>
  
  <nav class="pagination">
    <a class="prev" href="/">
        <i class="iconfont icon-left"></i>
        <span class="prev-text">Prev</span>
      </a>
    <a class="next" href="/page/3/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
  </nav>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme -
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy;
    2005 -
    2024
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Yuvi</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.1c70606d1b733282f06230615f5561b5894924b6f9930ba2ab99cf1254f75a1a.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>








</body>
</html>
