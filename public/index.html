<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Yuvi Panda</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Yuvi Panda" /><meta name="description" content="Blog of Yuvi Panda" /><meta name="keywords" content="yuvi, yuvipanda" />






<meta name="generator" content="Hugo 0.70.0 with theme even" />


<link rel="canonical" href="http://words.yuvi.in/" />
  <link href="http://words.yuvi.in/index.xml" rel="alternate" type="application/rss+xml" title="Yuvi Panda" />
  <link href="http://words.yuvi.in/index.xml" rel="feed" type="application/rss+xml" title="Yuvi Panda" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.78f8f17bab244b9ee62ad16480c9584d5fc2db06ae20681d1ca225cefd80767c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Yuvi Panda" />
<meta property="og:description" content="Blog of Yuvi Panda" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://words.yuvi.in/" />
<meta property="og:updated_time" content="2020-06-27T13:27:49+05:30" />
<meta itemprop="name" content="Yuvi Panda">
<meta itemprop="description" content="Blog of Yuvi Panda"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Yuvi Panda"/>
<meta name="twitter:description" content="Blog of Yuvi Panda"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Yuvi Panda</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="https://github.com/yuvipanda">
        <li class="mobile-menu-item">GitHub</li>
      </a><a href="https://twitter.com/yuvipanda">
        <li class="mobile-menu-item">Twitter</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Yuvi Panda</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="https://github.com/yuvipanda">GitHub</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://twitter.com/yuvipanda">Twitter</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <section id="posts" class="posts">
    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/dask-local-kubernetes/">Run dask-kubernetes clusters on a cloud from your Laptop</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-06-27 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          <a href="/categories/dask/"> dask </a>
          </div>
        <span class="more-meta"> 967 words </span>
        <span class="more-meta"> 5 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>You can run your Jupyter Notebook locally, and connect easily to a remote <code>dask-kubernetes</code> cluster
on a cloud-based Kubernetes Cluster with the help of <a href="https://kubefwd.com/">kubefwd</a>. This notebook
will show you an example of how to do so. While this example is a Jupyter Notebook, the code will work
any local python medium - REPL, IDE (vscode), or just plain ol&rsquo; <code>.py</code> files</p>
<p>Latest executable version of this notebook can be found in <a href="https://github.com/yuvipanda/cloud-local-dask-kubernetes">this repository</a></p>
<h2 id="credit">Credit</h2>
<p>This work was sponsored by <a href="https://www.quansight.com/">Quansight</a> ❤️</p>
<h2 id="create--setup-a-kubernetes-cluster">Create &amp; setup a Kubernetes cluster</h2>
<p>You need to have a working kubernetes cluster that is configured correctly. If you can get
<code>kubectl get ns</code> to work properly, it means your cluster is working fine &amp; connected for
this to go.</p>
<h2 id="install--run-kubefwd">Install &amp; run kubefwd</h2>
<p><code>kubefwd</code> lets you access services in your cloud Kubernetes cluster as if they were
localy, with a clever combination of ol&rsquo; school <code>/etc/hosts</code> hacks &amp; fancy kubernetes
port-forwarding. It requires root on Mac OS &amp; Linux, and should theoretically work on
Windows too (haven&rsquo;t tested).</p>
<p>Once you have installed it, run it in a separate terminal.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">sudo kubefwd svc -n default -n kube-system
</code></pre></td></tr></table>
</div>
</div><p>If you&rsquo;ve created your own namespace for your cluster, use that instead of <code>default</code>.
The <code>kube-system</code> is required until <a href="https://github.com/txn2/kubefwd/issues/132">this issue</a>
is fixed.</p>
<p>If the <code>kubefwd</code> command runs successfully, we&rsquo;re good to go!</p>
<h2 id="install-libraries-well-need">Install libraries we&rsquo;ll need</h2>
<p>In addition to <code>dask-kubernetes</code>, we&rsquo;ll also need <code>numpy</code> to test our cluster with dask arrays.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">%</span><span class="n">pip</span> <span class="n">install</span> <span class="n">numpy</span> <span class="n">dask</span> <span class="n">distributed</span> <span class="n">dask</span><span class="o">-</span><span class="n">kubernetes</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="setup-dask-kubernetes-configuration">Setup dask-kubernetes configuration</h2>
<p>Normally, the pod template would come from an external configuration file.
We keep this in the notebook to make it more self contained.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">POD_SPEC</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;kind&#39;</span><span class="p">:</span> <span class="s1">&#39;Pod&#39;</span><span class="p">,</span>
    <span class="s1">&#39;metadata&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s1">&#39;spec&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;restartPolicy&#39;</span><span class="p">:</span> <span class="s1">&#39;Never&#39;</span><span class="p">,</span>
        <span class="s1">&#39;containers&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="s1">&#39;daskdev/dask:latest&#39;</span><span class="p">,</span>
                <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="s1">&#39;dask-worker&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;--death-timeout&#39;</span><span class="p">,</span> <span class="s1">&#39;60&#39;</span>
                <span class="p">],</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;dask&#39;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="create-a-remote-cluster--connect-to-it">Create a remote cluster &amp; connect to it</h2>
<p>We create a <code>KubeCluster</code> object, with <code>deploymode='remote'</code>. This creates
the scheduler as a pod on the cluster, so worker &lt;-&gt; scheduler communication
is easy &amp; efficient. <code>kubefwd</code> helps us communicate to this remote scheduler,
so we can pretend we are actually on the remote cluster.</p>
<p>If you are using <code>kubectl</code> to watch the objects created in your namespace,
you&rsquo;ll see a <code>service</code> and a <code>pod</code> created for this. <code>kubefwd</code> should
also list a log line about forwarding the service port locally.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">dask_kubernetes</span> <span class="kn">import</span> <span class="n">KubeCluster</span>

<span class="n">cluster</span> <span class="o">=</span> <span class="n">KubeCluster</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">POD_SPEC</span><span class="p">,</span> <span class="n">deploy_mode</span><span class="o">=</span><span class="s1">&#39;remote&#39;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="create-some-workers">Create some workers</h2>
<p>We have a scheduler in the cloud, now time to create some workers in the
cloud! We create 2, and can watch the worker pods come up with glee in
<code>kubectl</code></p>
<p>All scaling methods (adaptive scaling, using the widget, etc) should work
here.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cluster</span><span class="o">.</span><span class="n">scale</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="run-some-computation">Run some computation!</h2>
<p>We test our cluster by doing some trivial calculations with dask arrays.
You can use any dask code as you normally would here, and it would
run on the cloud Kubernetes cluster. This is especially helpful if you
have large amounts of data in the cloud, since the workers would be
really close to where the data is.</p>
<p>You might get warnings about version mismatches. This is ok for the demo,
in production you&rsquo;d probably build your own docker image that will
have fixed versions.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">dask.distributed</span> <span class="kn">import</span> <span class="n">Client</span>
<span class="kn">import</span> <span class="nn">dask.array</span> <span class="kn">as</span> <span class="nn">da</span>

<span class="c1"># Connect Dask to the cluster</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">cluster</span><span class="p">)</span>

<span class="c1"># Create a large array and calculate the mean</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>
<span class="k">print</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">())</span>  <span class="c1"># Should print 1.0</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="cleanup-dask-cluster">Cleanup dask cluster</h2>
<p>When you&rsquo;re done with your cluster, remember to clean it up to release
the resources!</p>
<p>This doesn&rsquo;t affect your kubernetes cluster itself - you&rsquo;ll need to
clean that up manually</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="n">cluster</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="next-steps">Next steps?</h2>
<p>Lots more we can do from here.</p>
<h3 id="ephemeral-kubernetes-clusters">Ephemeral Kubernetes Clusters</h3>
<p>We can wrap kubernetes cluster creation in some nice python functions, letting users create kubernetes clusters just-in-time for running a dask-kubernetes cluster, and tearing it down when they&rsquo;re done. Users can thus &lsquo;bring their own compute&rsquo; - since the clusters will be in their cloud accounts - without having the complication of understanding how the cloud works. This is where this would be different from the wonderful <a href="https://gateway.dask.org">dask-gateway</a> project I think.</p>
<h3 id="remove-kubefwd">Remove kubefwd</h3>
<p><code>kubefwd</code> isn&rsquo;t strictly necessary, and should ideally be replaced by a <code>kubectl port-forward</code> call that doesn&rsquo;t require root. This should be possible with some changes to the <code>dask-kubernetes</code> code, so the client can connect to the scheduler via a different address (say, <code>localhost:8974</code>, since that&rsquo;s what <code>kubectl port-forward</code> gives us) vs the workers (which need something like <code>dask-cluster-scheduler-c12.namespace:8786</code>, since that is in-cluster address).</p>
<p>Longer term, it would be great if we can get rid of spawning other processes altogether, if/when the python kubernetes client gains the <a href="https://github.com/kubernetes-client/python/issues/166">ability to port-forward</a>.</p>
<h3 id="integration-with-tljh">Integration with TLJH</h3>
<p>I love <a href="https://tljh.jupyter.org">The Littlest JupyterHub (TLJH)</a>. A common use case is that a group of
users need a JupyterHub, mostly doing work that&rsquo;s well seved by TLJH. However, sometimes they
need to scale up to a big dask cluster to do some work, but not for long. In these cases, I believe
a combination of TLJH + Ephemeral Kubernetes Clusters is far simpler &amp; easier to manage than running
a full Kubernetes based JupyterHub. In addition, we can share the conda environment from TLJH with
the dask workers, <strong>removing the need for users to think about docker images or environment
mismatches completely</strong>. This is a massive win, and merits further exploration.</p>
<h3 id="heading">???</h3>
<p>I am not actually an end user of dask, so I&rsquo;m sure actual dask users will have much more ideas.
Or they won&rsquo;t, and this will just end up being a clever hack that gives me some joy :D Who
knows!</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/google-domain/">Check if an organization is using GSuite</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-06-18 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          </div>
        <span class="more-meta"> 157 words </span>
        <span class="more-meta"> 1 min read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>I needed to find out if an organization was using <a href="https://gsuite.google.com/">GSuite</a> for their emails, so I can allow their users to login to a <a href="https://github.com/berkeley-dsep-infra/datahub/tree/ab2bf49be680480cf9de07968561257e7810850f/deployments/buds-2020">JupyterHub</a> I was setting up. I use Google Auth in other places, so I wanted to find out if this organization was using GSuite.</p>
<p>I could&rsquo;ve just <em>asked</em> them, but where&rsquo;s the fun in that? Instead, you can use <code>dig</code> to find out!</p>
<p>For example, if I were to test <code>berkeley.edu</code>, I can run:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">$ dig -t mx berkeley.edu
</code></pre></td></tr></table>
</div>
</div><p>This gives me a bunch of output, the important bits of which are:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">;; ANSWER SECTION:
berkeley.edu.		242	IN	MX	5 alt1.aspmx.l.google.com.
berkeley.edu.		242	IN	MX	10 alt3.aspmx.l.google.com.
berkeley.edu.		242	IN	MX	10 alt4.aspmx.l.google.com.
berkeley.edu.		242	IN	MX	1 aspmx.l.google.com.
berkeley.edu.		242	IN	MX	5 alt2.aspmx.l.google.com.
</code></pre></td></tr></table>
</div>
</div><p>This means that mail to <code>anyone@berkeley.edu</code> is routed via Google, so I know this organization is using GSuite for their users!</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/on-being-entitled-user/">On Being an &#39;Entitled User&#39;</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-28 </span>
      
        <span class="more-meta"> 595 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>Entitled users burn out maintainers. While my massive burning out wasn&rsquo;t directly related, it didn&rsquo;t help either. For a <strong>lot</strong> of other maintainers, it has been a primary source of burnout. This is an unfortunate reality of our time. There are a ton of stories from maintainers out there -see <a href="https://twitter.com/michaelwaskom/status/1264295556475731969?s=20">this</a> for a recent example. Not going to rehash that.</p>
<p>However, I&rsquo;ve recently found myself on the &lsquo;other side&rsquo; of this coin. I exhibited the following symptoms</p>
<ul>
<li>Whining about lack of documentation. I discover useful nuggets from helpful people on chat and by reading through the code, but don&rsquo;t actually contribute those to docs.</li>
<li>Complain about technology choices, without a lot of actual experience in the domain.</li>
<li>When technology choices that I favor <strong>were</strong> made, not actually put my effort into it. I acknowledge that I don&rsquo;t <strong>have</strong> to do this - I have little time too. But with whatever time I have, I wish I would do this than whine.</li>
<li>Hit-and-run engagement, where I only show up every few months whenever I am trying to solve a particular problem, complain / do things, then run away. Things seem to get more to my liking each time I come back, but I still seem to be complaining anyway. I also acknowledge that this is ok - I am burnt out too. But this does mean I can&rsquo;t expect to find working with this code base easy. It also means that the team of people actually working on it only interact with me when I&rsquo;m in this mode, which I don&rsquo;t like either.</li>
<li>Wade into emotionally charged situations based on events that have already happened in the project that I wasn&rsquo;t part of, trample around slightly, and then withdraw on recognizing I don&rsquo;t have the emotional bandwidth to fully understand what was happening. This makes the situation worse for everyone, including myself.</li>
<li>There&rsquo;s probably more behavior here that I don&rsquo;t recognize.</li>
</ul>
<p>In a lot of ways, I think my frustrations and criticisms are valid. However, there&rsquo;s very constructive ways to engage, and then there&rsquo;s just useless whining that burns other people out. I would like to think I&rsquo;ve generally picked the constructive way in most projects. But that has blinded me in my behavior in a few projects.</p>
<p>I&rsquo;m going to try and change my behavior to match what I&rsquo;d like a frustrated user to do in open source projects where I&rsquo;m the maintainer.</p>
<ul>
<li>I&rsquo;ll contribute documentation (either as blog posts, issues, or doc PRs) when I find solutions to problems that I am frustrated by</li>
<li>If I favor other technology choices, I&rsquo;d provide constructive criticism of why, and then STFU. Or, I&rsquo;ll actually work on making the change. I will not continue to whine.</li>
<li>When I recognize an emotionally charged situation, I will limit myself to actions I can fully emotionally engage in. This is a limitation of my own emotional bandwidth, fueled by burnout and other things. I&rsquo;m simply recognizing the limitation, and trying to not make anything worse.</li>
<li>I do have a right to whine, and I&rsquo;ll do so in private to people not otherwise engaged in the project.</li>
<li>I will generally ask myself &lsquo;how would I like a user to behave if I was the maintainer?&rsquo; and try to act in that way</li>
</ul>
<p>To be clear, these are the things I want to change about myself based on my situation. This isn&rsquo;t a prescriptive list for other people to follow.</p>
<p>To the wonderful hardworking people who are maintainers of any popular open source projects - thank you for putting up with me.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/note-taking-why/">Note taking: Why bother?</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-26 </span>
      
        <span class="more-meta"> 105 words </span>
        <span class="more-meta"> 1 min read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>Talking to <a href="https://ankursethi.in/">Ankur Sethi</a> made me think more clearly about <strong>why</strong> I want <a href="http://words.yuvi.in/post/note-taking-part-i/">note-taking</a>, <a href="http://words.yuvi.in/post/note-taking-ii-bookmarks/">bookmarking setups</a>.</p>
<p>I am <strong>trying to stop feeling so overwhelmed by moving things out of my puny brain</strong>.</p>
<p>The solution to this is two fold.</p>
<ol>
<li>Commit to and do fewer things. Already working on this.</li>
<li>Be more efficient in the things you are doing.</li>
</ol>
<p>A few years ago I gave up on chasing efficiency gains because they were all
so marginal (hello, maintaining a super customized <code>.vimrc</code>). But I think I
threw out the baby with the bathwater there, by focusing on the wrong kinds
of efficiency. So am trying again!</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/note-taking-ii-bookmarks/">Note Taking II - Retaining consumed content</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-24 </span>
      
        <span class="more-meta"> 1044 words </span>
        <span class="more-meta"> 5 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>In conversation with <a href="https://nirbheek.in/">Nirbheek</a> about <a href="http://words.yuvi.in/post/note-taking-part-i/">my blog post on note taking</a>, he said something like &lsquo;my system of knowledge has holes, and I lose track of stuff I learnt because of that&rsquo;. This was slightly complementary to my earlier quest - the outliner helped me in structuring how I thought and produced content. However, a bookmarking system will help me consume and <strong>retain</strong> knowledge. Both need to be integrated, but I currently had only one half of the puzzle.</p>
<p>We ended up talking about &lsquo;bookmarks&rsquo; and how he has a lot of them. I&rsquo;ve felt the need for saving stuff I read in useful ways, but never used bookmarks because I never look at them again. It would be awesome to have a system of that sort - especially if it was integrated into my notetaking and todo list solutions.</p>
<p>We talked about some current solutions - <a href="https://twitter.com/prxtl">Pratul</a>&lsquo;s meticulously tagged <a href="https://pinboard.in/">pinboard</a> account, <a href="https://ankursethi.in/">Ankur</a>&lsquo;s blog&rsquo;s <a href="https://ankursethi.in/category/links/">links category</a>. All this was too much work for me, but I couldn&rsquo;t quite articulate why. I&rsquo;ve tried both these options before and couldn&rsquo;t keep them up. Longevity was my goal here, so I kept looking.</p>
<h2 id="memex">Memex</h2>
<p>This lead us to <a href="https://github.com/WorldBrain/Memex">Memex</a>, and open source system (with a paid hosted version) that seemed to do everything we wanted. They made a particular point of <a href="https://github.com/WorldBrain/Memex#no-vc-money-no-exit-your-data--attention-stays-yours">not taking VC money</a>, which is a big draw for me.</p>
<p>Nirbheek tried it out, and found it buggy / wanting. Particularly, it only worked on half his bookmarks - the rest had rotten, or the import itself was buggy. This could be fixed with <a href="https://archive.org/">Internet Archive</a> integration, but there were a few more bugs about data loss in their <a href="https://github.com/WorldBrain/Memex/issues?q=is%3Aissue+is%3Aopen+sort%3Aupdated-desc">issue tracker</a> that didn&rsquo;t give me too much confidence. It does still look amazing, and I will try it out at some point soon - unlike Nirbheek, I don&rsquo;t have a few thousand bookmarks to import.</p>
<p>However, it gave met he name <strong>Memex</strong>, with a history behind it - an article by Vannevar Bush (Claude Shannon was his student) from 1945 called <strong><a href="https://en.wikipedia.org/wiki/Memex">As we may think</a></strong>. This was an extremely fascinating read - I read it in the <a href="http://worrydream.com/refs/Bush%20-%20As%20We%20May%20Think%20(Life%20Magazine%209-10-1945).pdf">original layout</a>, with fascinating ads by the side (Men&rsquo;s garters, for example).</p>
<p>Here is my <a href="/papers/as-we-may-think.pdf">annotated version</a>, with the origins of the rest of this blog post at the bottom. It&rsquo;s fairly short, so I suggest you read the original. I&rsquo;m not going to rehash it, but just talk about what I think I need in my &lsquo;bookmarking&rsquo; solution.</p>
<h2 id="what-is-a-bookmark">What is a bookmark?</h2>
<p>Bookmark is a terrible word for what I want, but I can&rsquo;t think of a better one right now. Bush defines the &lsquo;memex&rsquo; as:</p>
<blockquote>
<p>A memex is a device in which an individual stores all his books, records and communications, and which is mechanized so that it may be consulted with <strong>exceeding speed and flexibility</strong>. It is an <strong>enlarged intimate supplement to his memory</strong>.</p>
</blockquote>
<p>(Gendered pronouns in the source left in for for faithful reproduction. I&rsquo;d like to think that if this was written today, it would use gender neutral pronouns)</p>
<p>So a &lsquo;bookmark&rsquo; is an individual thing that I come across that I might possibly ever want to remember again. I can&rsquo;t remember it all, so I want to toss it into a &lsquo;bookmarking system&rsquo; that can be searched with &lsquo;exceeding speed and flexibility&rsquo;.</p>
<p>Based on this, I figured out my current criteria for looking at &amp; trying out such systems to find one that meets my needs.</p>
<h2 id="search-first">Search first</h2>
<p>I want my interface to be a simple text box into which I can type things, and it&rsquo;ll search the entire contents of everything I&rsquo;ve &lsquo;bookmarked&rsquo;. This should be articles I&rsquo;ve read, books, tweets, videos I&rsquo;ve watched, podcasts I&rsquo;ve listened to, my notes, etc. I don&rsquo;t want to do any tagging or categorizing myself.</p>
<p>Tagging and categorizing remind me of <a href="https://en.wikipedia.org/wiki/DMOZ">dmoz</a> and <a href="https://en.wikipedia.org/wiki/Yahoo!_Directory">Yahoo Directories</a>. Way too much work for me, and I&rsquo;ll never look at them again.</p>
<p>Bush calls <strong>selection</strong> (we would call that &lsquo;search&rsquo; today) as the primary problem , and rails against <strong>indexing</strong> (IMO we would call this tagging / categorizing) as insufficient.</p>
<p>This search needs to be <strong>extremely fast</strong>, and very relevant.</p>
<h2 id="never-forgets">Never forgets</h2>
<p>I should have access to these &lsquo;bookmarks&rsquo; all the time. This means cross-device sync (Android, iPad, Mac OS for me).</p>
<p>It also needs to actually archive all the content I throw at it. Save web pages fully. Download (and transcribe) videos / podcats. Find some way to keep books in there. No link rot, no &lsquo;shit this content is now behind a paywall&rsquo;, no &lsquo;damn, I wish I had my laptop with me&rsquo;.</p>
<h2 id="hyperlinking">Hyperlinking</h2>
<p>I should be able to connect bookmarks together. I guess this could be done with tagss, but I want something else that&rsquo;s better. Bush talks about being able to link &lsquo;bookmarks&rsquo; to each other with a blurb about the link - this is what we would call a &lsquo;hyperlink&rsquo; now.</p>
<p>My note taker has hyperlinks with other notes, but I should be able to hyperlink to content I have saved. I should also be able to link together content I&rsquo;ve saved that doesn&rsquo;t have links themselves.</p>
<p>Strong integration between this and my note taker is probably the way to go. <strong>Each piece of content should have highlights, and notes attached to them</strong>. These could contain hyperlinks easily. The highlights and notes should also be searchable.</p>
<h2 id="publishable">Publishable</h2>
<p>Bush talks about &lsquo;trailblazers&rsquo; - people who find new content, link it together in useful ways, and publish it for others.</p>
<p>This was how I used <a href="https://en.wikipedia.org/wiki/Google_Reader#Sharing">Google Reader&rsquo;s Shared</a> functionality. You could publish a link with all the content you have consumed that you marked as &lsquo;shared&rsquo;, with a note as well. I would subscribe to other people&rsquo;s shared feeds, and find useful content (and blogs) to follow.</p>
<p>RIP Google Reader. It continues to make me wary of relying on any of Google&rsquo;s services.</p>
<p>Having a note taker has already drastically changed how I think and  produce content. I feel integrating this into my life will have similar effects on how I consume content. Now that I have a better idea of what I <strong>want</strong>, I&rsquo;ll spend some more time looking.</p>
<h2 id="credits">Credits</h2>
<p>Thanks to <a href="https://nirbheek.in/">Nirbheek</a>, <a href="https://ankursethi.in/">Ankur Sethi</a> and <a href="https://prtksxna.com/">Prateek</a> for conversations and thoughts on this topic :)</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/note-taking-part-i/">Note Taking Part I</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-17 </span>
      
        <span class="more-meta"> 1115 words </span>
        <span class="more-meta"> 6 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>I am trying to find a nice way to keep thoughts, ideas and notes outside my head for a few months now.
I worked my way through many applications, trying to use the system they promote as the basis for my own. Along the journey, I got a better sense of what was important to me in such an application. I&rsquo;ll walk through the various applications I&rsquo;ve tried, along with the criteria I&rsquo;ve developed by the end</p>
<h2 id="evernote">Evernote</h2>
<p>First stop, big one. I already had misgivings about it being from a large corporation. I still paid for it, and tested it out for a few months.</p>
<ul>
<li>No markdown support. This immediately became a problem - I had no idea how much I&rsquo;ve come to expect markdown wherever I type. They have been <a href="https://discussion.evernote.com/topic/118932-native-markdown-support/">asked for markdown support</a> many times, but I don&rsquo;t think this is ever going to happen. I realized that <strong>markdown support is a minimum requirement</strong> for me</li>
<li>Conflict resolution when I edited the same note in multiple places was really terrible. Completely unusable. I&rsquo;ve 3 devices I use regularly - an iPad Pro, a Macbook and my Android Phone. Through this experience I discovered that <strong>proper cross-device syncing is very important</strong> for me as well.</li>
<li>I paid Evernote so I could work offline. I already have a lot of anxiety about not having internet access (a topic for another post), and didn&rsquo;t want to not have access to these if I don&rsquo;t have internet access. This wasn&rsquo;t very good thanks to the shitty conflict resolution, but the process made me realize that I cared a lot about <strong>full offline availability</strong></li>
<li>I also hated the UI. It was clunky, had way too many options, and none of the options I really wanted.</li>
<li>There was no way to link notes together I found. I realized that my time at wikimedia had made me very accustomed to hyperlinking as a way of writing. Evernote had no clear affordances for doing this. So <strong>hyperlinking</strong> became important to me. I could also smile at the big impact Wikimedia has had on the way I think :D This was the beginning of me recognizing that a purely hierarchical setup might not work for me&hellip;</li>
</ul>
<p>I noticed I was using Evernote less and less, and wandered the desert for a while.</p>
<h2 id="onenote">OneNote</h2>
<p>I had been using OneNote on and off for a while. It has some of the same problems Evernote has. But the absolute no-go for me was how it handled text notes on my laptop.</p>
<p><img src="/images/note-taking/onenote-terrible.png" alt="one note being terrible"></p>
<p>This <strong>feature</strong> killed it. It was too much mental load, and I hated the extra UI it brought. It had most of the problems evernote did, and worse.</p>
<h2 id="list-applications">List applications</h2>
<p>At this point, I read some parts of <a href="https://www.goodreads.com/book/show/1633.Getting_Things_Done">Getting Things Done</a> again, trying to control my sprawling, anxiety-filled work life. It was useful, as always, but mostly to remind me to <strong>not use my brain to store data</strong>.</p>
<p>I then spent a bunch of time bouncing between different <strong>todo list apps</strong>, as a way to get stuff out of my brain and into a list. Learning about <a href="https://www.becktench.com/blog/2019/5/13/kinder-to-do-lists">kinder todo lists</a> was very helpful.</p>
<p>I tried a lot of these apps - Google Keep, <a href="https://www.nirvanahq.com/">Nirvana</a>, Evernote / OneNote, <a href="https://ticktick.com/">TickTick</a>. Nothing really clicked, but eventually I ended up on <a href="https://todoist.com/app/">Todoist</a>. The app was great, sync worked fine, and my flatmate also used it. Boom!</p>
<p>I was still looking for a note-taking app, which I considered quite distinct from the todo list apps. I was also finding the fixed format of todoist a bit limiting. I wanted each of my Projects to have a criteria of &lsquo;this is now done&rsquo;, but there wasn&rsquo;t an easy way to do that in Todoist. The importance given to due dates was also nagging, and gave me anxiety.</p>
<h2 id="inkdrophttpswwwinkdropapp"><a href="https://www.inkdrop.app/">Inkdrop</a></h2>
<p>Looking for cross-device markdown note taking apps led me to Inkdrop. Built by a single indie dev, <a href="https://my.inkdrop.app/plugins">has lots of plugins</a>, and looked quite nice. I started using it and quite liked it in the beginning. It has a <a href="https://my.inkdrop.app/plugins/vim">vim plugin</a> which is an absolute requirement for me if I&rsquo;m going to be writing a lot of text (or so I thought)
However, I found I wasn&rsquo;t using it as much. It had all the features I thought I wanted, but somehow it wasn&rsquo;t quite fitting the mental model I had.</p>
<h2 id="outliners">Outliners</h2>
<p>At this point, I heard about <a href="https://roamresearch.com/">Roam Research</a>. It looked really neat, and was quite different from the other note taking apps. I had always dismissed <a href="https://orgmode.org/">org-mode</a> for its emacs-centrism, but this made me reconsider that. However, it was in closed beta, so I let it be. I&rsquo;ll definitely re-visit it, especially if it has a good offline story.</p>
<p>I looked around for alternatives, and discovered <a href="https://workflowy.com/">workflowey</a>. I&rsquo;ll admit the list of endorsements on their home page was a big draw for me.
However, when I tried to sign up, I got</p>
<p><img src="/images/note-taking/workflowey-password.jpg" alt="one note being terrible"></p>
<p>My usual password length is 63, and it totally <a href="https://twitter.com/WorkFlowy/status/1261034917011632128">failed that test</a>. I also discovered <a href="https://workflowy.zendesk.com/hc/en-us/community/posts/360007921026-Needs-some-kind-of-Markdown-syntax-support-">they don&rsquo;t support markdown</a> so that rules them out</p>
<h2 id="dynalist">Dynalist</h2>
<p>I discovered <strong><a href="https://dynalist.io/">Dynalist</a></strong> as a Workflowey alternative. It has all the things I want, and I&rsquo;ve been using it for a few days now. It&rsquo;s been extremely awesome! The syncing is flakey, and I have some anxiety about losing data - but otherwise, the format itself has been great for me!</p>
<p>So what I&rsquo;ve realized is that I don&rsquo;t want a note taking app, <strong>I wanted an outliner</strong>. Outliners seem to match how my brain works much better than purely hierarchical note taking apps. I can take notes without having to worry about organizing them first, and then organize them afterwards as I see fit. Very low mental overhad between what is in my brain and what&rsquo;s on the screen. I like it.</p>
<p>I hope I can replace todoist with Dynalist too. I&rsquo;ll experiment with it later. But for now, &lt;3 dynalist. This blog post was written in dynalist, then edited in <a href="https://typora.io/">typora</a>. Not bad.</p>
<h2 id="evaluation-criteria">Evaluation criteria</h2>
<p>In the end, looks like I have these needs when it comes to outliners / note taking apps.</p>
<ul>
<li>
<p>Markdown support, ideally with something like <a href="https://katex.org/">KaTeX</a> or <a href="https://www.mathjax.org/">MathJax</a> support</p>
</li>
<li>
<p>Cross-device sync across platforms (Mac, iPad, Android)</p>
</li>
<li>
<p>Full offline support, with sync that doesn&rsquo;t lose data</p>
</li>
<li>
<p>Ability to hyperlink different parts of the system</p>
</li>
</ul>
<p>I&rsquo;ll look at Roam research later, but for now, I&rsquo;m enjoying having a note taking system that matches how my brain seems to think.</p>
<h2 id="credits">Credits</h2>
<p>Lots of good conversations about this in various places with <a href="https://www.deobald.ca/">Steve Deobald</a>, <a href="https://twitter.com/prxtl">Pratul Kalia</a>, <a href="https://twitter.com/robla">Robla</a>, <a href="https://prtksxna.com/">Prateek</a>, <a href="https://ankursethi.in/">Ankur Sethi</a> and many others who I am clearly forgetting.</p>
<p>Would love to hear about what you use, via <a href="mailto:yuvipanda@gmail.com">Email</a> or <a href="https://twitter.com/yuvipanda">Twitter</a>.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/miss-blogging/">I miss blogging too</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2020-05-17 </span>
      
        <span class="more-meta"> 272 words </span>
        <span class="more-meta"> 2 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>This person <a href="http://tttthis.com/blog/if-i-could-bring-one-thing-back-to-the-internet-it-would-be-blogs">misses blogs a lot</a>.
So do I. I made many frients, built myself a platform, and expressed myself in ways I do not feel
like I can anymore on my various blogs. Some of them are lost to time, but some are there if you know
how to find it.</p>
<p>Part of it was where my life was - I had time, nobody physically nearby I jived with, and a
<strong>lot</strong> of angst. But now, I have too little time, and too many (hah!) wonderful people I enjoy
interacting with on a 1-1 basis, nearby or not. Plus, with the death of blogging platforms
(Medium is a publishing platform, not a blogging one), content is harder to find. As the author
points out,</p>
<blockquote>
<p>The other day I searched for an hour and couldn&rsquo;t find even one. They used to be endless. You&rsquo;d just click on one you knew on Blogger and either click Blogger&rsquo;s random blog button, or go to the sidebar of the blog you knew where they always had a list of blogs they liked, sometimes four or 5, sometimes 20 other blogs. And the same with Tumbler.</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Technorati">Technorati</a> is dead, and there isn&rsquo;t anything like it.
Twitter, Facebook, Instagram, Medium, etc are no replacements for long form text insight into
someone&rsquo;s lives. They have brought the internet experience to way more people, but I feel like
they have taken something away from me.</p>
<p>I guess this will be one of those blog posts that end with me saying &ldquo;I will try to blog more&rdquo;
and then there are no more posts for the next few years :)</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/devlog-2018-12-26/">Devlog 2018 12 26</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2018-12-26 </span>
      <div class="post-category">
          <a href="/categories/devlog/"> devlog </a>
          <a href="/categories/code/"> code </a>
          </div>
        <span class="more-meta"> 494 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <h2 id="physical-activity">Physical activity</h2>
<p>I walked for about 6 miles yesterday evening, after doing 3-4 miles each day for about 2-3 days before. The roads were empty, and it was lovely. I&rsquo;ve listened to maybe 6-10 hours of <a href="https://en.wikipedia.org/wiki/Deborah_Frances-White">Deborah Frances-White</a> in the last week or so, split between <a href="http://guiltyfeminist.com/">The Guilty Feminist</a> and <a href="http://globalpillage.net/">Global Pillage</a>. Next time though, I&rsquo;m going to try listen to podcasts less &amp; observe my surroundings more. I am doing this (plus PT) to rehab my knee mostly. I slept for 12h yesterday night :)</p>
<h2 id="asyncio-deadlock">Asyncio deadlock</h2>
<p>I don&rsquo;t have enough experience with the pitfalls of concurrent programming where you <em>have</em> to use <a href="https://docs.python.org/3/library/asyncio-sync.html">synchronization</a> techniques. I had my first deadlock today, and after a few minutes realized it was actually an infinite recursion from a typo. I need to get a better theoretical understanding of both event loop based async programming and synchronization methods. I&rsquo;ve used them with threading &amp; Java, but feel shaky in asyncio.</p>
<p>simperviser now has 100% unit test coverage. But it combines asyncio,
processes &amp; signals - so that doesn&rsquo;t give me enough confidence as it might have otherwise. I&rsquo;ll take it though :)</p>
<h2 id="vscode-customization">VSCode customization</h2>
<p>I&rsquo;ve been re-reading the pragmatic programmer again (after initially reading it about 12 years or so ago). A lot of it still holds up, although some stuff is date (love for Broken Window policing &amp; perl). It reminded me that I hadn&rsquo;t really spent much time customizing and being more productive in VSCode, so am spending time today doing that.</p>
<p>I switch between vscode and my terminal quite a bit, mostly for git operations and running tests. I&rsquo;m going to see if I can stay inside vscode comfortably for running pytest based tests.</p>
<p>It made me very sad that the only thing I wanted from the pytest integration in vscode is something the maintainers aren&rsquo;t actively working on - <a href="https://github.com/Microsoft/vscode-python/issues/637">shortcut to run test the cursor is currently at</a>. I also can&rsquo;t seem
to see test output directly.</p>
<p>I think I&rsquo;ll be using the Terminal for pytest runs for now. I&rsquo;m not even going to try with git.</p>
<p>If I was younger and not already full of projects to do, I&rsquo;d have picked up and tried to make a PR for this. Boo time commitments.</p>
<h2 id="readyness-check">Readyness check</h2>
<p>I rallied late in the day &amp; wrote some code around readyness checks in simpervisor. I don&rsquo;t fully understand what I want it to do, but I&rsquo;m going to look at what kubernetes does &amp; try to follow that. Since this is being written for nbserverproxy, I am also going to try port nbserverproxy to simpervisor to see what kind of API affordances I&rsquo;m missing. Primarily, I feel there should be a lock somewhere, but:</p>
<ol>
<li>I don&rsquo;t have a unified theory of what needs locking &amp; why</li>
<li>I don&rsquo;t know if I need a lock or another synchronization mechanism</li>
<li>I don&rsquo;t know how it&rsquo;ll actually be used by the application</li>
</ol>
<p>So designing by porting nbserverproxy seems right.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/devlog-2018-12-24/">Devlog 2018 12 24</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2018-12-24 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          <a href="/categories/devlog/"> devlog </a>
          </div>
        <span class="more-meta"> 469 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <h2 id="gracefully-exiting-asyncio-application">Gracefully exiting asyncio application</h2>
<p>Continuing yesterday&rsquo;s work on my <a href="https://github.com/yuvipanda/simpervisor">simple supervisor library</a>,
I continued trying to propagate signals cleanly to child processes
before exiting. I remembered that it isn&rsquo;t enough to just propagate
signals - you also have to actually reap them. This meant waiting
for <code>wait</code> calls on them to return.</p>
<p>I had a task running concurrently that is waiting on these
processes. So &lsquo;all&rsquo; I had to do was make sure the application
does <em>not</em> exit until these tasks are done. This turned
out to be harder than I thought! After a bunch of reading, I
recognized that what I needed to do was make sure I wait
for all pending tasks before actually exiting the application.</p>
<p>This was more involved than I thought. It also must be done
at the application level rather than in the library - you don&rsquo;t
want libraries doing sys.exit, and definitely don&rsquo;t want them
closing event loops.</p>
<p>After a bunch of looking and playing, it <em>looks</em> like what I want is
in my application code is something like:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="o">.</span><span class="n">all_tasks</span><span class="p">()))</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></td></tr></table>
</div>
</div><p>This waits for all tasks to complete before exiting, and seems
to make sure all child processes are reaped. However, I have a
few unresolved questions:</p>
<ol>
<li>What happens when one of the tasks is designed to run forever,
and never exit? Should we cancel all tasks? Cancel tasks after
a timeout? Cancelling tasks after a timeout seems most
appropriate.</li>
<li>If a task schedules more tasks, do those get run? Or are they
abandoned? This seems important - can tasks keep adding more
tasks in a loop?</li>
</ol>
<p>I am getting a better handle on what people mean by &lsquo;asyncio is
more complicated than needed&rsquo;. I&rsquo;m going to find places to read
up on asyncio internals - particularly how the list of pending
tasks is maintained.</p>
<p>This <a href="https://www.roguelynn.com/words/asyncio-we-did-it-wrong-pt-1/">series of blog posts</a>
and <a href="https://www.youtube.com/watch?v=1lJDZx6f6tY">this EuroPython talk</a>
from <a href="https://www.roguelynn.com/">Lynn Root</a> helped a lot.
So did <a href="https://github.com/saghul">Saúl Ibarra Corretgé</a> (one of the asyncio core devs)
talk on <a href="https://www.youtube.com/watch?v=HppNu0-ANYw">asyncio internals</a></p>
<h3 id="testing">Testing</h3>
<p>Testing code that involves asyncio, signals and processes is
hard. I attempted to do so with <code>os.fork</code>, but decided that is
super-hard mode and I&rsquo;d rather not play. Instead, I wrote Python
code verbatim that is then spawned as a subprocess, and use
stdout to communicate back to the parent process. The child process&rsquo;
code itself is <a href="https://github.com/yuvipanda/simpervisor/blob/b130203a0a497d26f438a6ab3c9511a3c3de60ab/tests/test_atexitasync.py#L13">inline</a>
in the test file, which is terrible. I am going to move it to its
own file.</p>
<p>I also added tests for multiple signal handlers. I&rsquo;ve been writing
a lot more tests in the last few months than I was before. I credit
<a href="https://github.com/betatim">Tim Head</a> for a lot of this. It definitely
gives me a lot more confidence in my code.</p>

  </div>
</article>

    <article class="post">
  <header class="post-header">
    <h1 class="post-title"><a class="post-link" href="/post/devlog-2018-12-23/">DevLog 2018 December 23</a></h1>
    <div class="post-meta">
      <span class="post-time"> 2018-12-23 </span>
      <div class="post-category">
          <a href="/categories/code/"> code </a>
          <a href="/categories/devlog/"> devlog </a>
          </div>
        <span class="more-meta"> 551 words </span>
        <span class="more-meta"> 3 mins read </span>
    </div>
  </header>
  
  <div class="post-content">
      <p>I have enjoyed keeping running logs of my coding work (devlogs)
in the past, and am going to start doing those again now.</p>
<p>This &lsquo;holiday&rsquo; season, I am spending time teaching myself
skills I sortof know about but do not have a deep understanding of.</p>
<h2 id="jupyterlab-extension">JupyterLab extension</h2>
<p>I spent the first part of the day (before I started devlogging)
working on finishing up a <a href="https://github.com/yuvipanda/jupyterlab-nbmetadata">jupyterlab extension</a>
I started the day before. It lets you <a href="https://github.com/jupyterlab/jupyterlab/issues/1308">edit notebook metadata</a>.
I got started since I wanted to use <a href="https://github.com/mwouts/jupytext">Jupytext</a>
for my work on publishing <a href="https://github.com/yuvipanda/mybinder.org-analytics">mybinder.org-analytics</a>.</p>
<p>TypeScript was easy to pick up coming from C#. I wish the
phospor / JupyterLab code had more documentation though.</p>
<p>I ran into <a href="https://github.com/jupyterlab/jupyterlab/issues/5802">a bug</a>.
While following instructions to set up a JupyterLab dev
setup, I somehow managed to <a href="https://github.com/jupyterlab/jupyterlab/issues/5803">delete my source code</a>.
Thankfully I got most of it back thanks to a saved copy
in vscode. It was a sour start to the morning though.</p>
<p>I&rsquo;ll get back on to this once the sour taste is gone,
and hopefully the bug is fixed :)</p>
<h2 id="asyncio-whats-next--yuri-selivanov--pybay-2018">asyncio: what&rsquo;s next | Yuri Selivanov @ PyBay 2018</h2>
<p>I&rsquo;ve been trying to get a better handle on asyncio. I can
use it, but I don&rsquo;t fully understand it - I am probably leaving
bugs everywhere&hellip;</p>
<!-- raw HTML omitted -->
<p>From one of the asyncio maintainers. Gave me some impetus
to <a href="https://github.com/jupyter/repo2docker/pull/539">push the default version of Python</a> on mybinder.org to 3.7 :D
I&rsquo;m most excited about getting features from Trio &amp; Curio into
the standard library. Was good to hear that nobody can quite
figure out exception handling, and not just me.</p>
<p>I discovered <a href="https://github.com/observerss/aioutils">aioutils</a>
while searching around after this. I&rsquo;ve copy pasted code that
theoretically does the same things as <code>Group</code> and <code>Pool</code> from
<code>aioutils</code>, but I&rsquo;ve no idea if they are right. I&rsquo;ll be using
this library from now!</p>
<h2 id="processing-signals">Processing Signals</h2>
<p>I&rsquo;m writing a simple process supervisor library to replace the
janky parts of nbserverproxy. It should have the following
features:</p>
<ol>
<li>Restart processes when they die</li>
<li>Propagate signals appropriately</li>
<li>Support a sense of &lsquo;readiness&rsquo; probes (not liveness)</li>
<li>Be very well tested</li>
<li>Run on asyncio</li>
</ol>
<p>This is more difficult than it seems, and am slowly working my
way through it. (1) isn&rsquo;t too difficult.</p>
<p>(2) is a fair bit more difficult. <code>atexit</code> is useless since it doesn&rsquo;t do
anything with SIGTERM. So I need to manage my own SIGTERM
handlers. However, this means there needs to be a centralish
location of some sort that decides <em>when</em> to exit. This introduces
global state, and I don&rsquo;t like that at all. But unix signals are
global, and maybe there&rsquo;s nothing for me to do here.</p>
<p>I initially created a Supervisor class that holds a bunch of
SupervisedProcess&rsquo;s, but it was still calling sys.exit in it.
Since signals are global, I realize there&rsquo;s no other real
way to handle this, and so I made a global handler setup too.
This has the additional advantage of being able to remove
handlers when a SupervisedProcess dies, avoiding memory
leaks and stuff.</p>
<p>Testing this stuff is hard!</p>
<p>I also need to make sure I don&rsquo;t end up with lots of races.
I&rsquo;m still writing concurrent code, even without threads.
Gotta be careefull. Especially with signals thrown in. Although
I guess once you get a SIGTERM or SIGINT inconsistent state
is not particularly worrysome.</p>

  </div>
</article>

    </section>
  
  <nav class="pagination">
    
    <a class="next" href="/page/2/">
        <span class="next-text">Next</span>
        <i class="iconfont icon-right"></i>
      </a>
  </nav>
        </div>
        

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="http://localhost:1313" class="iconfont icon--pocket" title="-pocket"></a>
      <a href="mailto:yuvipanda@gmail.com" class="iconfont icon-email" title="email"></a>
      <a href="https://twitter.com/yuvipanda" class="iconfont icon-twitter" title="twitter"></a>
      <a href="https://github.com/yuvipanda" class="iconfont icon-github" title="github"></a>
  <a href="http://words.yuvi.in/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2005 - 
    2020
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span>
    <span class="author">Yuvi Panda</span>
  </span>
</div>
    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="/js/main.min.d7b7ada643c9c1a983026e177f141f7363b4640d619caf01d8831a6718cd44ea.js"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"  integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-110578237-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>







</body>
</html>
