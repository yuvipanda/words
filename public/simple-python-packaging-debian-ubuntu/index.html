<!DOCTYPE html>
<html>
<head>
    <title>Simple python packaging for Debian / Ubuntu // Yuvi Panda</title>

        <meta charset="utf-8">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <meta name="description" content="Open Knowledge | Open Source | Jupyter | Kubernetes | Wikimedia | Python">
    <meta name="keywords" content="">
    <meta name="author" content="">
        <meta property="og:title" content="Simple python packaging for Debian / Ubuntu" />
    <meta property="og:description" content="Open Knowledge | Open Source | Jupyter | Kubernetes | Wikimedia | Python" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:url" content="http://words.yuvi.in/simple-python-packaging-debian-ubuntu/" />
    

    <link href="" rel="alternate" type="application/rss+xml" title="Yuvi Panda" />
    <link rel="shortcut icon" href="/favicon.png">

    <link href="http://words.yuvi.in/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
    <link href="http://words.yuvi.in/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">

    <link rel="stylesheet" href="http://words.yuvi.in/css/style.css">

    <link href="http://gmpg.org/xfn/11" rel="profile">
    
    <meta name="generator" content="Hugo 0.31.1" />
</head>


<body>
<div id="container">
    <header id="header">
    <div id="header-outer" class="outer">
        <div id="header-inner" class="inner">
            <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
            <a id="logo" class="logo-text" href="http://words.yuvi.in/">Yuvi Panda</a>
            <nav id="main-nav">
                
                <a class="main-nav-link" href="mailto:yuvipanda@gmail.com">email</a>
                
                <a class="main-nav-link" href="https://github.com/yuvipanda">github</a>
                
                <a class="main-nav-link" href="https://twitter.com/yuvipanda">twitter</a>
                
            </nav>
            <nav id="sub-nav">
                <div id="search-form-wrap">
                </div>
            </nav>
        </div>
    </div>
</header>
    <section id="main" class="outer">
        <article class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        <header class="article-header">
            <h1 class="article-title" itemprop="name">Simple python packaging for Debian / Ubuntu</h1>
        </header>
        
        <div class="article-meta">
            <a href="/simple-python-packaging-debian-ubuntu/" class="article-date">
                <time datetime='2014-08-19T13:08:28.000&#43;00:00' itemprop="datePublished">2014-08-19</time>
            </a>
            
            
            <div class="post-categories">
                <div class="article-category">
                    
                    
                    <a class="article-category-link" href="http://words.yuvi.in//categories/code">code</a>
                    
                </div>
            </div>
            
            
        </div>
        <div class="article-entry" itemprop="articleBody">
            <p>(As requested by <a href="https://twitter.com/JeanFred">Jean-Fred</a>)</p>

<p>One of the &#8216;pain points&#8217; with working on deploying python stuff at Wikimedia is that <code>pip</code> and <code>virtualenvs</code> are banned on production, for some (what I now understand as) good reasons (the solid Signing / Security issues with PYPI, and the slightly less solid but nonetheless valid &#8216;If we use pip for python and gem for ruby and npm for node, EXPLOSION OF PACKAGE MANAGERS and makes things harder to manage&#8217;). I was whining about how hard debian packaging was for quite a while without checking how easy/hard it was to package python specifically, and when I finally did, it turned out to be quite not that hard.</p>

<p>Use <a href="https://pypi.python.org/pypi/stdeb">python-stdeb</a>.</p>

<p>Really, that is it. Ignore most other things (until you run into issues that require them :P). It can translate most python packages that are packaged for PyPI into .debs that mostly pass <a href="https://lintian.debian.org/">lintian</a> checks. Simplest way to package, that I&#8217;ve been following for a while is:</p>

<ol>
<li>Install <code>python-stdeb</code> (from pip or apt). Usually requires the packages <code>python-all</code>, <code>fakeroot</code> and <code>build-essential</code>, although for some reason these aren&#8217;t required by the debian package for <code>stdeb</code>. Make sure you&#8217;re on the same distro you are building the package for.</li>
<li><code>git clone</code> the package from its source</li>
<li>Run <code>python setup.py --command-packages=stdeb.command bdist_deb</code> (or <code>python3</code> if you want to make Python 3 package)</li>
<li>Run <code>lintian</code> on it. If it spots errors, go back and fix them, usually by editing the <code>setup.py</code> file (or sometimes a <code>stdeb.cfg</code> file). This is usually rather obvious and easy enough to fix.</li>
<li>Run <code>dpkg -i &lt;package&gt;</code> to try to install the package. This will error out if it can&#8217;t find the packages that your package depends on. This means that they haven&#8217;t been packaged for debian yet. You can mostly fix this by finding that package, and making a deb for it, and installing it as well (recursively making debs for packages as you need them). While this sounds onerous, the fact is that most python packages already exist as deb packages and you <code>stdeb</code> will just work for them. You might have to do this more if you&#8217;re packaging for an older distro (<em>cough</em> <em>cough</em> <code>precise</code> <em>cough</em> <em>cough</em>), but is much easier on newer distros.</li>
<li>Put your package in a repository! If you want to use this on Wikimedia Labs, you should use <a href="https://wikitech.wikimedia.org/wiki/Help:Using_debs_in_labs">Labsdebrepo</a>. Other environments will have similar ways to make the package available via <code>apt-get</code>. Avoid the temptation to just <code>dpkg -i</code> it on machines manually :)</li>
</ol>

<p>That&#8217;s pretty much it! Much simpler than I originally expected, and not much confusing / conflicting docs. The docs for <code>stdeb</code> are pretty nice and complete, so do read these!</p>

<p>Will update the post as I learn more.</p>

        </div>

        
        
        

        


        
    </div>
    <nav id="article-nav">
    
    <a href="/devlog-19-aug-2014/" id="article-nav-newer" class="article-nav-link-wrap">
        <div class="article-nav-title"><span>&lt;</span>&nbsp;
            Devlog for 19 Aug 2014
        </div>
    </a>
    
    
    <a href="/paying-irccloud/" id="article-nav-older" class="article-nav-link-wrap">
        <div class="article-nav-title">Paying for IRCCloud&nbsp;<span>&gt;</span></div>
    </a>
    
</nav>
</article>

        
    </section>
    <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 Yuvi Panda&nbsp;
            Powered by <a href="https://gohugo.io" target="_blank">Hugo</a> with theme <a href="https://github.com/carsonip/hugo-theme-minos">Minos</a>
        </div>
    </div>
    

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/tomorrow-night.min.css" integrity="sha256-2wL88NKUqvJi/ExflDzkzUumjUM73mcK2gBvBBeLvTk=" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script>
        document.getElementById('main-nav-toggle').addEventListener('click', function () {
            var header = document.getElementById('header');
            if (header.classList.contains('mobile-on')) {
                header.classList.remove('mobile-on');
            } else {
                header.classList.add('mobile-on');
            }
        });
    </script>
</footer>
</div>
</body>
</html>
